{"version":3,"sources":["../../../src/fields/Relationship/createRelationMap.ts"],"sourcesContent":["import type { Value } from './types.js'\n\ntype RelationMap = {\n  [relation: string]: (number | string)[]\n}\n\ntype CreateRelationMap = (args: {\n  hasMany: boolean\n  relationTo: string | string[]\n  value: Value | Value[] | null // really needs to be `ValueWithRelation`\n}) => RelationMap\n\nexport const createRelationMap: CreateRelationMap = ({ hasMany, relationTo, value }) => {\n  const hasMultipleRelations = Array.isArray(relationTo)\n  let relationMap: RelationMap\n  if (Array.isArray(relationTo)) {\n    relationMap = relationTo.reduce((map, current) => {\n      return { ...map, [current]: [] }\n    }, {})\n  } else {\n    relationMap = { [relationTo]: [] }\n  }\n\n  if (value === null) {\n    return relationMap\n  }\n\n  const add = (relation: string, id: unknown) => {\n    if ((typeof id === 'string' || typeof id === 'number') && typeof relation === 'string') {\n      if (relationMap[relation]) {\n        relationMap[relation].push(id)\n      } else {\n        relationMap[relation] = [id]\n      }\n    }\n  }\n\n  if (hasMany && Array.isArray(value)) {\n    value.forEach((val) => {\n      if (\n        hasMultipleRelations &&\n        typeof val === 'object' &&\n        'relationTo' in val &&\n        'value' in val\n      ) {\n        add(val.relationTo, val.value)\n      }\n\n      if (!hasMultipleRelations && typeof relationTo === 'string') {\n        add(relationTo, val)\n      }\n    })\n  } else if (hasMultipleRelations && Array.isArray(relationTo)) {\n    if (typeof value === 'object' && 'relationTo' in value && 'value' in value) {\n      add(value.relationTo, value.value)\n    }\n  } else {\n    add(relationTo, value)\n  }\n\n  return relationMap\n}\n"],"names":["createRelationMap","hasMany","relationTo","value","hasMultipleRelations","Array","isArray","relationMap","reduce","map","current","add","relation","id","push","forEach","val"],"mappings":"AAYA,OAAO,MAAMA,oBAAuC,CAAC,EAAEC,OAAO,EAAEC,UAAU,EAAEC,KAAK,EAAE;IACjF,MAAMC,uBAAuBC,MAAMC,OAAO,CAACJ;IAC3C,IAAIK;IACJ,IAAIF,MAAMC,OAAO,CAACJ,aAAa;QAC7BK,cAAcL,WAAWM,MAAM,CAAC,CAACC,KAAKC;YACpC,OAAO;gBAAE,GAAGD,GAAG;gBAAE,CAACC,QAAQ,EAAE,EAAE;YAAC;QACjC,GAAG,CAAC;IACN,OAAO;QACLH,cAAc;YAAE,CAACL,WAAW,EAAE,EAAE;QAAC;IACnC;IAEA,IAAIC,UAAU,MAAM;QAClB,OAAOI;IACT;IAEA,MAAMI,MAAM,CAACC,UAAkBC;QAC7B,IAAI,AAAC,CAAA,OAAOA,OAAO,YAAY,OAAOA,OAAO,QAAO,KAAM,OAAOD,aAAa,UAAU;YACtF,IAAIL,WAAW,CAACK,SAAS,EAAE;gBACzBL,WAAW,CAACK,SAAS,CAACE,IAAI,CAACD;YAC7B,OAAO;gBACLN,WAAW,CAACK,SAAS,GAAG;oBAACC;iBAAG;YAC9B;QACF;IACF;IAEA,IAAIZ,WAAWI,MAAMC,OAAO,CAACH,QAAQ;QACnCA,MAAMY,OAAO,CAAC,CAACC;YACb,IACEZ,wBACA,OAAOY,QAAQ,YACf,gBAAgBA,OAChB,WAAWA,KACX;gBACAL,IAAIK,IAAId,UAAU,EAAEc,IAAIb,KAAK;YAC/B;YAEA,IAAI,CAACC,wBAAwB,OAAOF,eAAe,UAAU;gBAC3DS,IAAIT,YAAYc;YAClB;QACF;IACF,OAAO,IAAIZ,wBAAwBC,MAAMC,OAAO,CAACJ,aAAa;QAC5D,IAAI,OAAOC,UAAU,YAAY,gBAAgBA,SAAS,WAAWA,OAAO;YAC1EQ,IAAIR,MAAMD,UAAU,EAAEC,MAAMA,KAAK;QACnC;IACF,OAAO;QACLQ,IAAIT,YAAYC;IAClB;IAEA,OAAOI;AACT,EAAC"}