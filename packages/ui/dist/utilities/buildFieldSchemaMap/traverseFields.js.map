{"version":3,"sources":["../../../src/utilities/buildFieldSchemaMap/traverseFields.ts"],"sourcesContent":["import type { I18n } from '@payloadcms/translations'\nimport type { Field, SanitizedConfig } from 'payload'\n\nimport { MissingEditorProp } from 'payload'\nimport { tabHasName } from 'payload/shared'\n\nimport type { FieldSchemaMap } from './types.js'\n\ntype Args = {\n  config: SanitizedConfig\n  fields: Field[]\n  i18n: I18n<any, any>\n  schemaMap: FieldSchemaMap\n  schemaPath: string\n}\n\nexport const traverseFields = ({ config, fields, i18n, schemaMap, schemaPath }: Args) => {\n  for (const field of fields) {\n    switch (field.type) {\n      case 'group':\n      case 'array':\n        schemaMap.set(`${schemaPath}.${field.name}`, field.fields)\n\n        traverseFields({\n          config,\n          fields: field.fields,\n          i18n,\n          schemaMap,\n          schemaPath: `${schemaPath}.${field.name}`,\n        })\n        break\n\n      case 'collapsible':\n      case 'row':\n        traverseFields({\n          config,\n          fields: field.fields,\n          i18n,\n          schemaMap,\n          schemaPath,\n        })\n        break\n\n      case 'blocks':\n        field.blocks.map((block) => {\n          const blockSchemaPath = `${schemaPath}.${field.name}.${block.slug}`\n\n          schemaMap.set(blockSchemaPath, block.fields)\n\n          traverseFields({\n            config,\n            fields: block.fields,\n            i18n,\n            schemaMap,\n            schemaPath: blockSchemaPath,\n          })\n        })\n        break\n\n      case 'richText':\n        if (!field?.editor) {\n          throw new MissingEditorProp(field) // while we allow disabling editor functionality, you should not have any richText fields defined if you do not have an editor\n        }\n        if (typeof field.editor === 'function') {\n          throw new Error('Attempted to access unsanitized rich text editor.')\n        }\n\n        if (typeof field.editor.generateSchemaMap === 'function') {\n          field.editor.generateSchemaMap({\n            config,\n            i18n,\n            schemaMap,\n            schemaPath: `${schemaPath}.${field.name}`,\n          })\n        }\n\n        break\n\n      case 'tabs':\n        field.tabs.map((tab) => {\n          const tabSchemaPath = tabHasName(tab) ? `${schemaPath}.${tab.name}` : schemaPath\n\n          if (tabHasName(tab)) {\n            schemaMap.set(tabSchemaPath, tab.fields)\n          }\n\n          traverseFields({\n            config,\n            fields: tab.fields,\n            i18n,\n            schemaMap,\n            schemaPath: tabSchemaPath,\n          })\n        })\n        break\n    }\n  }\n}\n"],"names":["MissingEditorProp","tabHasName","traverseFields","config","fields","i18n","schemaMap","schemaPath","field","type","set","name","blocks","map","block","blockSchemaPath","slug","editor","Error","generateSchemaMap","tabs","tab","tabSchemaPath"],"mappings":"AAGA,SAASA,iBAAiB,QAAQ,UAAS;AAC3C,SAASC,UAAU,QAAQ,iBAAgB;AAY3C,OAAO,MAAMC,iBAAiB,CAAC,EAAEC,MAAM,EAAEC,MAAM,EAAEC,IAAI,EAAEC,SAAS,EAAEC,UAAU,EAAQ;IAClF,KAAK,MAAMC,SAASJ,OAAQ;QAC1B,OAAQI,MAAMC,IAAI;YAChB,KAAK;YACL,KAAK;gBACHH,UAAUI,GAAG,CAAC,CAAC,EAAEH,WAAW,CAAC,EAAEC,MAAMG,IAAI,CAAC,CAAC,EAAEH,MAAMJ,MAAM;gBAEzDF,eAAe;oBACbC;oBACAC,QAAQI,MAAMJ,MAAM;oBACpBC;oBACAC;oBACAC,YAAY,CAAC,EAAEA,WAAW,CAAC,EAAEC,MAAMG,IAAI,CAAC,CAAC;gBAC3C;gBACA;YAEF,KAAK;YACL,KAAK;gBACHT,eAAe;oBACbC;oBACAC,QAAQI,MAAMJ,MAAM;oBACpBC;oBACAC;oBACAC;gBACF;gBACA;YAEF,KAAK;gBACHC,MAAMI,MAAM,CAACC,GAAG,CAAC,CAACC;oBAChB,MAAMC,kBAAkB,CAAC,EAAER,WAAW,CAAC,EAAEC,MAAMG,IAAI,CAAC,CAAC,EAAEG,MAAME,IAAI,CAAC,CAAC;oBAEnEV,UAAUI,GAAG,CAACK,iBAAiBD,MAAMV,MAAM;oBAE3CF,eAAe;wBACbC;wBACAC,QAAQU,MAAMV,MAAM;wBACpBC;wBACAC;wBACAC,YAAYQ;oBACd;gBACF;gBACA;YAEF,KAAK;gBACH,IAAI,CAACP,OAAOS,QAAQ;oBAClB,MAAM,IAAIjB,kBAAkBQ,OAAO,8HAA8H;;gBACnK;gBACA,IAAI,OAAOA,MAAMS,MAAM,KAAK,YAAY;oBACtC,MAAM,IAAIC,MAAM;gBAClB;gBAEA,IAAI,OAAOV,MAAMS,MAAM,CAACE,iBAAiB,KAAK,YAAY;oBACxDX,MAAMS,MAAM,CAACE,iBAAiB,CAAC;wBAC7BhB;wBACAE;wBACAC;wBACAC,YAAY,CAAC,EAAEA,WAAW,CAAC,EAAEC,MAAMG,IAAI,CAAC,CAAC;oBAC3C;gBACF;gBAEA;YAEF,KAAK;gBACHH,MAAMY,IAAI,CAACP,GAAG,CAAC,CAACQ;oBACd,MAAMC,gBAAgBrB,WAAWoB,OAAO,CAAC,EAAEd,WAAW,CAAC,EAAEc,IAAIV,IAAI,CAAC,CAAC,GAAGJ;oBAEtE,IAAIN,WAAWoB,MAAM;wBACnBf,UAAUI,GAAG,CAACY,eAAeD,IAAIjB,MAAM;oBACzC;oBAEAF,eAAe;wBACbC;wBACAC,QAAQiB,IAAIjB,MAAM;wBAClBC;wBACAC;wBACAC,YAAYe;oBACd;gBACF;gBACA;QACJ;IACF;AACF,EAAC"}