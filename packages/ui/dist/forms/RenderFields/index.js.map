{"version":3,"sources":["../../../src/forms/RenderFields/index.tsx"],"sourcesContent":["'use client'\nimport React from 'react'\n\nimport type { Props } from './types.js'\n\nimport { useIntersect } from '../../hooks/useIntersect.js'\nimport { useTranslation } from '../../providers/Translation/index.js'\nimport { RenderField } from './RenderField.js'\nimport './index.scss'\n\nconst baseClass = 'render-fields'\n\nexport { Props }\n\nexport const RenderFields: React.FC<Props> = (props) => {\n  const { className, fieldMap, forceRender, indexPath, margins, path, permissions, schemaPath } =\n    props\n\n  const { i18n } = useTranslation()\n  const [hasRendered, setHasRendered] = React.useState(Boolean(forceRender))\n  const [intersectionRef, entry] = useIntersect(\n    {\n      rootMargin: '1000px',\n    },\n    Boolean(forceRender),\n  )\n\n  const isIntersecting = Boolean(entry?.isIntersecting)\n  const isAboveViewport = entry?.boundingClientRect?.top < 0\n  const shouldRender = forceRender || isIntersecting || isAboveViewport\n\n  React.useEffect(() => {\n    if (shouldRender && !hasRendered) {\n      setHasRendered(true)\n    }\n  }, [shouldRender, hasRendered])\n\n  if (!fieldMap || (Array.isArray(fieldMap) && fieldMap.length === 0)) {\n    return null\n  }\n\n  if (!i18n) {\n    console.error('Need to implement i18n when calling RenderFields') // eslint-disable-line no-console\n  }\n\n  if (fieldMap) {\n    return (\n      <div\n        className={[\n          baseClass,\n          className,\n          margins && `${baseClass}--margins-${margins}`,\n          margins === false && `${baseClass}--margins-none`,\n        ]\n          .filter(Boolean)\n          .join(' ')}\n        ref={intersectionRef}\n      >\n        {hasRendered &&\n          fieldMap?.map((f, fieldIndex) => {\n            const {\n              type,\n              CustomField,\n              custom,\n              disabled,\n              fieldComponentProps,\n              fieldComponentProps: { readOnly },\n              isHidden,\n            } = f\n\n            const forceRenderChildren =\n              (typeof forceRender === 'number' && fieldIndex <= forceRender) || true\n\n            const name = 'name' in f ? f.name : undefined\n\n            return (\n              <RenderField\n                CustomField={CustomField}\n                custom={custom}\n                disabled={disabled}\n                fieldComponentProps={{ ...fieldComponentProps, forceRender: forceRenderChildren }}\n                indexPath={indexPath !== undefined ? `${indexPath}.${fieldIndex}` : `${fieldIndex}`}\n                isHidden={isHidden}\n                key={fieldIndex}\n                name={name}\n                path={path}\n                permissions={permissions?.[name]}\n                readOnly={readOnly}\n                schemaPath={schemaPath}\n                siblingPermissions={permissions}\n                type={type}\n              />\n            )\n          })}\n      </div>\n    )\n  }\n\n  return null\n}\n"],"names":["React","useIntersect","useTranslation","RenderField","baseClass","RenderFields","props","className","fieldMap","forceRender","indexPath","margins","path","permissions","schemaPath","i18n","hasRendered","setHasRendered","useState","Boolean","intersectionRef","entry","rootMargin","isIntersecting","isAboveViewport","boundingClientRect","top","shouldRender","useEffect","Array","isArray","length","console","error","div","filter","join","ref","map","f","fieldIndex","type","CustomField","custom","disabled","fieldComponentProps","readOnly","isHidden","forceRenderChildren","name","undefined","siblingPermissions"],"mappings":"AAAA;;AACA,OAAOA,WAAW,QAAO;AAIzB,SAASC,YAAY,QAAQ,8BAA6B;AAC1D,SAASC,cAAc,QAAQ,uCAAsC;AACrE,SAASC,WAAW,QAAQ,mBAAkB;AAC9C,OAAO,eAAc;AAErB,MAAMC,YAAY;AAIlB,OAAO,MAAMC,eAAgC,CAACC;IAC5C,MAAM,EAAEC,SAAS,EAAEC,QAAQ,EAAEC,WAAW,EAAEC,SAAS,EAAEC,OAAO,EAAEC,IAAI,EAAEC,WAAW,EAAEC,UAAU,EAAE,GAC3FR;IAEF,MAAM,EAAES,IAAI,EAAE,GAAGb;IACjB,MAAM,CAACc,aAAaC,eAAe,GAAGjB,MAAMkB,QAAQ,CAACC,QAAQV;IAC7D,MAAM,CAACW,iBAAiBC,MAAM,GAAGpB,aAC/B;QACEqB,YAAY;IACd,GACAH,QAAQV;IAGV,MAAMc,iBAAiBJ,QAAQE,OAAOE;IACtC,MAAMC,kBAAkBH,OAAOI,oBAAoBC,MAAM;IACzD,MAAMC,eAAelB,eAAec,kBAAkBC;IAEtDxB,MAAM4B,SAAS,CAAC;QACd,IAAID,gBAAgB,CAACX,aAAa;YAChCC,eAAe;QACjB;IACF,GAAG;QAACU;QAAcX;KAAY;IAE9B,IAAI,CAACR,YAAaqB,MAAMC,OAAO,CAACtB,aAAaA,SAASuB,MAAM,KAAK,GAAI;QACnE,OAAO;IACT;IAEA,IAAI,CAAChB,MAAM;QACTiB,QAAQC,KAAK,CAAC,oDAAoD,iCAAiC;;IACrG;IAEA,IAAIzB,UAAU;QACZ,qBACE,KAAC0B;YACC3B,WAAW;gBACTH;gBACAG;gBACAI,WAAW,CAAC,EAAEP,UAAU,UAAU,EAAEO,QAAQ,CAAC;gBAC7CA,YAAY,SAAS,CAAC,EAAEP,UAAU,cAAc,CAAC;aAClD,CACE+B,MAAM,CAAChB,SACPiB,IAAI,CAAC;YACRC,KAAKjB;sBAEJJ,eACCR,UAAU8B,IAAI,CAACC,GAAGC;gBAChB,MAAM,EACJC,IAAI,EACJC,WAAW,EACXC,MAAM,EACNC,QAAQ,EACRC,mBAAmB,EACnBA,qBAAqB,EAAEC,QAAQ,EAAE,EACjCC,QAAQ,EACT,GAAGR;gBAEJ,MAAMS,sBACJ,AAAC,OAAOvC,gBAAgB,YAAY+B,cAAc/B,eAAgB;gBAEpE,MAAMwC,OAAO,UAAUV,IAAIA,EAAEU,IAAI,GAAGC;gBAEpC,qBACE,KAAC/C;oBACCuC,aAAaA;oBACbC,QAAQA;oBACRC,UAAUA;oBACVC,qBAAqB;wBAAE,GAAGA,mBAAmB;wBAAEpC,aAAauC;oBAAoB;oBAChFtC,WAAWA,cAAcwC,YAAY,CAAC,EAAExC,UAAU,CAAC,EAAE8B,WAAW,CAAC,GAAG,CAAC,EAAEA,WAAW,CAAC;oBACnFO,UAAUA;oBAEVE,MAAMA;oBACNrC,MAAMA;oBACNC,aAAaA,aAAa,CAACoC,KAAK;oBAChCH,UAAUA;oBACVhC,YAAYA;oBACZqC,oBAAoBtC;oBACpB4B,MAAMA;mBAPDD;YAUX;;IAGR;IAEA,OAAO;AACT,EAAC"}