{"version":3,"sources":["../../../src/elements/SaveDraftButton/index.tsx"],"sourcesContent":["'use client'\n\nimport React, { useCallback, useRef } from 'react'\n\nimport { useForm, useFormModified } from '../../forms/Form/context.js'\nimport { FormSubmit } from '../../forms/Submit/index.js'\nimport { useHotkey } from '../../hooks/useHotkey.js'\nimport { useConfig } from '../../providers/Config/index.js'\nimport { useDocumentInfo } from '../../providers/DocumentInfo/index.js'\nimport { useEditDepth } from '../../providers/EditDepth/index.js'\nimport { useLocale } from '../../providers/Locale/index.js'\nimport { useOperation } from '../../providers/Operation/index.js'\nimport { useTranslation } from '../../providers/Translation/index.js'\n\nconst baseClass = 'save-draft'\n\nexport const DefaultSaveDraftButton: React.FC = () => {\n  const {\n    routes: { api },\n    serverURL,\n  } = useConfig()\n  const { id, collectionSlug, globalSlug } = useDocumentInfo()\n  const modified = useFormModified()\n  const { code: locale } = useLocale()\n  const ref = useRef<HTMLButtonElement>(null)\n  const editDepth = useEditDepth()\n  const { t } = useTranslation()\n  const { submit } = useForm()\n  const operation = useOperation()\n\n  const forceDisable = operation === 'update' && !modified\n\n  const saveDraft = useCallback(async () => {\n    if (forceDisable) return\n\n    const search = `?locale=${locale}&depth=0&fallback-locale=null&draft=true`\n    let action\n    let method = 'POST'\n\n    if (collectionSlug) {\n      action = `${serverURL}${api}/${collectionSlug}${id ? `/${id}` : ''}${search}`\n      if (id) method = 'PATCH'\n    }\n\n    if (globalSlug) {\n      action = `${serverURL}${api}/globals/${globalSlug}${search}`\n    }\n\n    await submit({\n      action,\n      method,\n      overrides: {\n        _status: 'draft',\n      },\n      skipValidation: true,\n    })\n  }, [submit, collectionSlug, globalSlug, serverURL, api, locale, id, forceDisable])\n\n  useHotkey({ cmdCtrlKey: true, editDepth, keyCodes: ['s'] }, (e) => {\n    if (forceDisable) {\n      // absorb the event\n    }\n\n    e.preventDefault()\n    e.stopPropagation()\n    if (ref?.current) {\n      ref.current.click()\n    }\n  })\n\n  return (\n    <FormSubmit\n      buttonId=\"action-save-draft\"\n      buttonStyle=\"secondary\"\n      className={baseClass}\n      disabled={forceDisable}\n      onClick={saveDraft}\n      ref={ref}\n      size=\"small\"\n      type=\"button\"\n    >\n      {t('version:saveDraft')}\n    </FormSubmit>\n  )\n}\n\ntype Props = {\n  CustomComponent?: React.ReactNode\n}\n\nexport const SaveDraftButton: React.FC<Props> = ({ CustomComponent }) => {\n  if (CustomComponent) return CustomComponent\n  return <DefaultSaveDraftButton />\n}\n"],"names":["React","useCallback","useRef","useForm","useFormModified","FormSubmit","useHotkey","useConfig","useDocumentInfo","useEditDepth","useLocale","useOperation","useTranslation","baseClass","DefaultSaveDraftButton","routes","api","serverURL","id","collectionSlug","globalSlug","modified","code","locale","ref","editDepth","t","submit","operation","forceDisable","saveDraft","search","action","method","overrides","_status","skipValidation","cmdCtrlKey","keyCodes","e","preventDefault","stopPropagation","current","click","buttonId","buttonStyle","className","disabled","onClick","size","type","SaveDraftButton","CustomComponent"],"mappings":"AAAA;;AAEA,OAAOA,SAASC,WAAW,EAAEC,MAAM,QAAQ,QAAO;AAElD,SAASC,OAAO,EAAEC,eAAe,QAAQ,8BAA6B;AACtE,SAASC,UAAU,QAAQ,8BAA6B;AACxD,SAASC,SAAS,QAAQ,2BAA0B;AACpD,SAASC,SAAS,QAAQ,kCAAiC;AAC3D,SAASC,eAAe,QAAQ,wCAAuC;AACvE,SAASC,YAAY,QAAQ,qCAAoC;AACjE,SAASC,SAAS,QAAQ,kCAAiC;AAC3D,SAASC,YAAY,QAAQ,qCAAoC;AACjE,SAASC,cAAc,QAAQ,uCAAsC;AAErE,MAAMC,YAAY;AAElB,OAAO,MAAMC,yBAAmC;IAC9C,MAAM,EACJC,QAAQ,EAAEC,GAAG,EAAE,EACfC,SAAS,EACV,GAAGV;IACJ,MAAM,EAAEW,EAAE,EAAEC,cAAc,EAAEC,UAAU,EAAE,GAAGZ;IAC3C,MAAMa,WAAWjB;IACjB,MAAM,EAAEkB,MAAMC,MAAM,EAAE,GAAGb;IACzB,MAAMc,MAAMtB,OAA0B;IACtC,MAAMuB,YAAYhB;IAClB,MAAM,EAAEiB,CAAC,EAAE,GAAGd;IACd,MAAM,EAAEe,MAAM,EAAE,GAAGxB;IACnB,MAAMyB,YAAYjB;IAElB,MAAMkB,eAAeD,cAAc,YAAY,CAACP;IAEhD,MAAMS,YAAY7B,YAAY;QAC5B,IAAI4B,cAAc;QAElB,MAAME,SAAS,CAAC,QAAQ,EAAER,OAAO,wCAAwC,CAAC;QAC1E,IAAIS;QACJ,IAAIC,SAAS;QAEb,IAAId,gBAAgB;YAClBa,SAAS,CAAC,EAAEf,UAAU,EAAED,IAAI,CAAC,EAAEG,eAAe,EAAED,KAAK,CAAC,CAAC,EAAEA,GAAG,CAAC,GAAG,GAAG,EAAEa,OAAO,CAAC;YAC7E,IAAIb,IAAIe,SAAS;QACnB;QAEA,IAAIb,YAAY;YACdY,SAAS,CAAC,EAAEf,UAAU,EAAED,IAAI,SAAS,EAAEI,WAAW,EAAEW,OAAO,CAAC;QAC9D;QAEA,MAAMJ,OAAO;YACXK;YACAC;YACAC,WAAW;gBACTC,SAAS;YACX;YACAC,gBAAgB;QAClB;IACF,GAAG;QAACT;QAAQR;QAAgBC;QAAYH;QAAWD;QAAKO;QAAQL;QAAIW;KAAa;IAEjFvB,UAAU;QAAE+B,YAAY;QAAMZ;QAAWa,UAAU;YAAC;SAAI;IAAC,GAAG,CAACC;QAC3D,IAAIV,cAAc;QAChB,mBAAmB;QACrB;QAEAU,EAAEC,cAAc;QAChBD,EAAEE,eAAe;QACjB,IAAIjB,KAAKkB,SAAS;YAChBlB,IAAIkB,OAAO,CAACC,KAAK;QACnB;IACF;IAEA,qBACE,KAACtC;QACCuC,UAAS;QACTC,aAAY;QACZC,WAAWjC;QACXkC,UAAUlB;QACVmB,SAASlB;QACTN,KAAKA;QACLyB,MAAK;QACLC,MAAK;kBAEJxB,EAAE;;AAGT,EAAC;AAMD,OAAO,MAAMyB,kBAAmC,CAAC,EAAEC,eAAe,EAAE;IAClE,IAAIA,iBAAiB,OAAOA;IAC5B,qBAAO,KAACtC;AACV,EAAC"}