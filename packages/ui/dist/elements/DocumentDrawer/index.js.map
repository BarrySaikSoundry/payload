{"version":3,"sources":["../../../src/elements/DocumentDrawer/index.tsx"],"sourcesContent":["'use client'\nimport { useModal } from '@faceless-ui/modal'\nimport { getTranslation } from '@payloadcms/translations'\nimport React, { useCallback, useEffect, useId, useMemo, useState } from 'react'\n\nimport type { DocumentDrawerProps, DocumentTogglerProps, UseDocumentDrawer } from './types.js'\n\nimport { useRelatedCollections } from '../../fields/Relationship/AddNew/useRelatedCollections.js'\nimport { useEditDepth } from '../../providers/EditDepth/index.js'\nimport { useTranslation } from '../../providers/Translation/index.js'\nimport { Drawer, DrawerToggler } from '../Drawer/index.js'\nimport { DocumentDrawerContent } from './DrawerContent.js'\nimport './index.scss'\n\nexport const baseClass = 'doc-drawer'\n\nconst formatDocumentDrawerSlug = ({\n  id,\n  collectionSlug,\n  depth,\n  uuid,\n}: {\n  collectionSlug: string\n  depth: number\n  id: number | string\n  uuid: string // supply when creating a new document and no id is available\n}) => `doc-drawer_${collectionSlug}_${depth}${id ? `_${id}` : ''}_${uuid}`\n\nexport const DocumentDrawerToggler: React.FC<DocumentTogglerProps> = ({\n  id,\n  children,\n  className,\n  collectionSlug,\n  disabled,\n  drawerSlug,\n  ...rest\n}) => {\n  const { i18n, t } = useTranslation()\n  const [collectionConfig] = useRelatedCollections(collectionSlug)\n\n  return (\n    <DrawerToggler\n      aria-label={t(!id ? 'fields:addNewLabel' : 'general:editLabel', {\n        label: getTranslation(collectionConfig.labels.singular, i18n),\n      })}\n      className={[className, `${baseClass}__toggler`].filter(Boolean).join(' ')}\n      disabled={disabled}\n      slug={drawerSlug}\n      {...rest}\n    >\n      {children}\n    </DrawerToggler>\n  )\n}\n\nexport const DocumentDrawer: React.FC<DocumentDrawerProps> = (props) => {\n  const { drawerSlug } = props\n\n  return (\n    <Drawer Header={null} className={baseClass} gutter={false} slug={drawerSlug}>\n      <DocumentDrawerContent {...props} />\n    </Drawer>\n  )\n}\n\nexport const useDocumentDrawer: UseDocumentDrawer = ({ id, collectionSlug }) => {\n  const drawerDepth = useEditDepth()\n  const uuid = useId()\n  const { closeModal, modalState, openModal, toggleModal } = useModal()\n  const [isOpen, setIsOpen] = useState(false)\n\n  const drawerSlug = formatDocumentDrawerSlug({\n    id,\n    collectionSlug,\n    depth: drawerDepth,\n    uuid,\n  })\n\n  useEffect(() => {\n    setIsOpen(Boolean(modalState[drawerSlug]?.isOpen))\n  }, [modalState, drawerSlug])\n\n  const toggleDrawer = useCallback(() => {\n    toggleModal(drawerSlug)\n  }, [toggleModal, drawerSlug])\n\n  const closeDrawer = useCallback(() => {\n    closeModal(drawerSlug)\n  }, [closeModal, drawerSlug])\n\n  const openDrawer = useCallback(() => {\n    openModal(drawerSlug)\n  }, [openModal, drawerSlug])\n\n  const MemoizedDrawer = useMemo(() => {\n    return (props) => (\n      <DocumentDrawer\n        {...props}\n        collectionSlug={collectionSlug}\n        drawerSlug={drawerSlug}\n        id={id}\n        key={drawerSlug}\n      />\n    )\n  }, [id, drawerSlug, collectionSlug])\n\n  const MemoizedDrawerToggler = useMemo(() => {\n    return (props) => (\n      <DocumentDrawerToggler\n        {...props}\n        collectionSlug={collectionSlug}\n        drawerSlug={drawerSlug}\n        id={id}\n      />\n    )\n  }, [id, drawerSlug, collectionSlug])\n\n  const MemoizedDrawerState = useMemo(\n    () => ({\n      closeDrawer,\n      drawerDepth,\n      drawerSlug,\n      isDrawerOpen: isOpen,\n      openDrawer,\n      toggleDrawer,\n    }),\n    [drawerDepth, drawerSlug, isOpen, toggleDrawer, closeDrawer, openDrawer],\n  )\n\n  return [MemoizedDrawer, MemoizedDrawerToggler, MemoizedDrawerState]\n}\n"],"names":["useModal","getTranslation","React","useCallback","useEffect","useId","useMemo","useState","useRelatedCollections","useEditDepth","useTranslation","Drawer","DrawerToggler","DocumentDrawerContent","baseClass","formatDocumentDrawerSlug","id","collectionSlug","depth","uuid","DocumentDrawerToggler","children","className","disabled","drawerSlug","rest","i18n","t","collectionConfig","aria-label","label","labels","singular","filter","Boolean","join","slug","DocumentDrawer","props","Header","gutter","useDocumentDrawer","drawerDepth","closeModal","modalState","openModal","toggleModal","isOpen","setIsOpen","toggleDrawer","closeDrawer","openDrawer","MemoizedDrawer","key","MemoizedDrawerToggler","MemoizedDrawerState","isDrawerOpen"],"mappings":"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"}