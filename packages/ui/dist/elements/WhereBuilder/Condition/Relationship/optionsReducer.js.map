{"version":3,"sources":["../../../../../src/elements/WhereBuilder/Condition/Relationship/optionsReducer.ts"],"sourcesContent":["import { getTranslation } from '@payloadcms/translations'\n\nimport type { Action, Option } from './types.js'\n\nconst reduceToIDs = (options) =>\n  options.reduce((ids, option) => {\n    if (option.options) {\n      return [...ids, ...reduceToIDs(option.options)]\n    }\n\n    return [...ids, option.id]\n  }, [])\n\nconst optionsReducer = (state: Option[], action: Action): Option[] => {\n  switch (action.type) {\n    case 'CLEAR': {\n      return action.required ? [] : [{ label: action.i18n.t('general:none'), value: 'null' }]\n    }\n\n    case 'ADD': {\n      const { collection, data, hasMultipleRelations, i18n, relation } = action\n\n      const labelKey = collection.admin.useAsTitle || 'id'\n\n      const loadedIDs = reduceToIDs(state)\n\n      if (!hasMultipleRelations) {\n        return [\n          ...state,\n          ...data.docs.reduce((docs, doc) => {\n            if (loadedIDs.indexOf(doc.id) === -1) {\n              loadedIDs.push(doc.id)\n              return [\n                ...docs,\n                {\n                  label: doc[labelKey],\n                  value: doc.id,\n                },\n              ]\n            }\n            return docs\n          }, []),\n        ]\n      }\n\n      const newOptions = [...state]\n      const optionsToAddTo = newOptions.find(\n        (optionGroup) => optionGroup.label === getTranslation(collection.labels.plural, i18n),\n      )\n\n      const newSubOptions = data.docs.reduce((docs, doc) => {\n        if (loadedIDs.indexOf(doc.id) === -1) {\n          loadedIDs.push(doc.id)\n\n          return [\n            ...docs,\n            {\n              label: doc[labelKey],\n              relationTo: relation,\n              value: doc.id,\n            },\n          ]\n        }\n\n        return docs\n      }, [])\n\n      if (optionsToAddTo) {\n        optionsToAddTo.options = [...optionsToAddTo.options, ...newSubOptions]\n      } else {\n        newOptions.push({\n          label: getTranslation(collection.labels.plural, i18n),\n          options: newSubOptions,\n          value: undefined,\n        })\n      }\n\n      return newOptions\n    }\n\n    default: {\n      return state\n    }\n  }\n}\n\nexport default optionsReducer\n"],"names":["getTranslation","reduceToIDs","options","reduce","ids","option","id","optionsReducer","state","action","type","required","label","i18n","t","value","collection","data","hasMultipleRelations","relation","labelKey","admin","useAsTitle","loadedIDs","docs","doc","indexOf","push","newOptions","optionsToAddTo","find","optionGroup","labels","plural","newSubOptions","relationTo","undefined"],"mappings":"AAAA,SAASA,cAAc,QAAQ,2BAA0B;AAIzD,MAAMC,cAAc,CAACC,UACnBA,QAAQC,MAAM,CAAC,CAACC,KAAKC;QACnB,IAAIA,OAAOH,OAAO,EAAE;YAClB,OAAO;mBAAIE;mBAAQH,YAAYI,OAAOH,OAAO;aAAE;QACjD;QAEA,OAAO;eAAIE;YAAKC,OAAOC,EAAE;SAAC;IAC5B,GAAG,EAAE;AAEP,MAAMC,iBAAiB,CAACC,OAAiBC;IACvC,OAAQA,OAAOC,IAAI;QACjB,KAAK;YAAS;gBACZ,OAAOD,OAAOE,QAAQ,GAAG,EAAE,GAAG;oBAAC;wBAAEC,OAAOH,OAAOI,IAAI,CAACC,CAAC,CAAC;wBAAiBC,OAAO;oBAAO;iBAAE;YACzF;QAEA,KAAK;YAAO;gBACV,MAAM,EAAEC,UAAU,EAAEC,IAAI,EAAEC,oBAAoB,EAAEL,IAAI,EAAEM,QAAQ,EAAE,GAAGV;gBAEnE,MAAMW,WAAWJ,WAAWK,KAAK,CAACC,UAAU,IAAI;gBAEhD,MAAMC,YAAYtB,YAAYO;gBAE9B,IAAI,CAACU,sBAAsB;oBACzB,OAAO;2BACFV;2BACAS,KAAKO,IAAI,CAACrB,MAAM,CAAC,CAACqB,MAAMC;4BACzB,IAAIF,UAAUG,OAAO,CAACD,IAAInB,EAAE,MAAM,CAAC,GAAG;gCACpCiB,UAAUI,IAAI,CAACF,IAAInB,EAAE;gCACrB,OAAO;uCACFkB;oCACH;wCACEZ,OAAOa,GAAG,CAACL,SAAS;wCACpBL,OAAOU,IAAInB,EAAE;oCACf;iCACD;4BACH;4BACA,OAAOkB;wBACT,GAAG,EAAE;qBACN;gBACH;gBAEA,MAAMI,aAAa;uBAAIpB;iBAAM;gBAC7B,MAAMqB,iBAAiBD,WAAWE,IAAI,CACpC,CAACC,cAAgBA,YAAYnB,KAAK,KAAKZ,eAAegB,WAAWgB,MAAM,CAACC,MAAM,EAAEpB;gBAGlF,MAAMqB,gBAAgBjB,KAAKO,IAAI,CAACrB,MAAM,CAAC,CAACqB,MAAMC;oBAC5C,IAAIF,UAAUG,OAAO,CAACD,IAAInB,EAAE,MAAM,CAAC,GAAG;wBACpCiB,UAAUI,IAAI,CAACF,IAAInB,EAAE;wBAErB,OAAO;+BACFkB;4BACH;gCACEZ,OAAOa,GAAG,CAACL,SAAS;gCACpBe,YAAYhB;gCACZJ,OAAOU,IAAInB,EAAE;4BACf;yBACD;oBACH;oBAEA,OAAOkB;gBACT,GAAG,EAAE;gBAEL,IAAIK,gBAAgB;oBAClBA,eAAe3B,OAAO,GAAG;2BAAI2B,eAAe3B,OAAO;2BAAKgC;qBAAc;gBACxE,OAAO;oBACLN,WAAWD,IAAI,CAAC;wBACdf,OAAOZ,eAAegB,WAAWgB,MAAM,CAACC,MAAM,EAAEpB;wBAChDX,SAASgC;wBACTnB,OAAOqB;oBACT;gBACF;gBAEA,OAAOR;YACT;QAEA;YAAS;gBACP,OAAOpB;YACT;IACF;AACF;AAEA,eAAeD,eAAc"}