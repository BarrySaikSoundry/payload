{"version":3,"sources":["../../../src/elements/DuplicateDocument/index.tsx"],"sourcesContent":["'use client'\n\nimport type { SanitizedCollectionConfig } from 'payload'\n\nimport { Modal, useModal } from '@faceless-ui/modal'\nimport { getTranslation } from '@payloadcms/translations'\nimport { useRouter } from 'next/navigation.js'\nimport React, { useCallback, useState } from 'react'\nimport { toast } from 'sonner'\n\nimport { useForm, useFormModified } from '../../forms/Form/context.js'\nimport { useConfig } from '../../providers/Config/index.js'\nimport { useLocale } from '../../providers/Locale/index.js'\nimport { useTranslation } from '../../providers/Translation/index.js'\nimport { requests } from '../../utilities/api.js'\nimport { Button } from '../Button/index.js'\nimport { PopupList } from '../Popup/index.js'\nimport './index.scss'\n\nconst baseClass = 'duplicate'\n\nexport type Props = {\n  id: string\n  singularLabel: SanitizedCollectionConfig['labels']['singular']\n  slug: string\n}\n\nexport const DuplicateDocument: React.FC<Props> = ({ id, slug, singularLabel }) => {\n  const router = useRouter()\n  const modified = useFormModified()\n  const { toggleModal } = useModal()\n  const locale = useLocale()\n  const { setModified } = useForm()\n  const {\n    routes: { api },\n    serverURL,\n  } = useConfig()\n  const {\n    routes: { admin },\n  } = useConfig()\n  const [hasClicked, setHasClicked] = useState<boolean>(false)\n  const { i18n, t } = useTranslation()\n\n  const modalSlug = `duplicate-${id}`\n\n  const handleClick = useCallback(\n    async (override = false) => {\n      setHasClicked(true)\n\n      if (modified && !override) {\n        toggleModal(modalSlug)\n        return\n      }\n      await requests\n        .post(\n          `${serverURL}${api}/${slug}/${id}/duplicate${locale?.code ? `?locale=${locale.code}` : ''}`,\n          {\n            body: JSON.stringify({}),\n            headers: {\n              'Accept-Language': i18n.language,\n              'Content-Type': 'application/json',\n              credentials: 'include',\n            },\n          },\n        )\n        .then(async (res) => {\n          const { doc, errors, message } = await res.json()\n          if (res.status < 400) {\n            toast.success(\n              message ||\n                t('general:successfullyDuplicated', { label: getTranslation(singularLabel, i18n) }),\n            )\n            setModified(false)\n            router.push(\n              `${admin}/collections/${slug}/${doc.id}${locale?.code ? `?locale=${locale.code}` : ''}`,\n            )\n          } else {\n            toast.error(\n              errors?.[0].message ||\n                message ||\n                t('error:unspecific', { label: getTranslation(singularLabel, i18n) }),\n            )\n          }\n        })\n    },\n    [\n      locale,\n      modified,\n      serverURL,\n      api,\n      slug,\n      id,\n      i18n,\n      toggleModal,\n      modalSlug,\n      t,\n      singularLabel,\n      setModified,\n      router,\n      admin,\n    ],\n  )\n\n  const confirm = useCallback(async () => {\n    setHasClicked(false)\n    await handleClick(true)\n  }, [handleClick])\n\n  return (\n    <React.Fragment>\n      <PopupList.Button id=\"action-duplicate\" onClick={() => handleClick(false)}>\n        {t('general:duplicate')}\n      </PopupList.Button>\n      {modified && hasClicked && (\n        <Modal className={`${baseClass}__modal`} slug={modalSlug}>\n          <div className={`${baseClass}__modal-template`}>\n            <h1>{t('general:confirmDuplication')}</h1>\n            <p>{t('general:unsavedChangesDuplicate')}</p>\n            <Button\n              buttonStyle=\"secondary\"\n              id=\"confirm-cancel\"\n              onClick={() => toggleModal(modalSlug)}\n              type=\"button\"\n            >\n              {t('general:cancel')}\n            </Button>\n            <Button id=\"confirm-duplicate\" onClick={confirm}>\n              {t('general:duplicateWithoutSaving')}\n            </Button>\n          </div>\n        </Modal>\n      )}\n    </React.Fragment>\n  )\n}\n"],"names":["Modal","useModal","getTranslation","useRouter","React","useCallback","useState","toast","useForm","useFormModified","useConfig","useLocale","useTranslation","requests","Button","PopupList","baseClass","DuplicateDocument","id","slug","singularLabel","router","modified","toggleModal","locale","setModified","routes","api","serverURL","admin","hasClicked","setHasClicked","i18n","t","modalSlug","handleClick","override","post","code","body","JSON","stringify","headers","language","credentials","then","res","doc","errors","message","json","status","success","label","push","error","confirm","Fragment","onClick","className","div","h1","p","buttonStyle","type"],"mappings":"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"}