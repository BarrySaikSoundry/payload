{"version":3,"sources":["../../../src/elements/DeleteDocument/index.tsx"],"sourcesContent":["'use client'\nimport type { SanitizedCollectionConfig } from 'payload'\n\nimport { Modal, useModal } from '@faceless-ui/modal'\nimport { getTranslation } from '@payloadcms/translations'\nimport { useRouter } from 'next/navigation.js'\nimport React, { useCallback, useState } from 'react'\nimport { toast } from 'sonner'\n\nimport { useForm } from '../../forms/Form/context.js'\nimport { useConfig } from '../../providers/Config/index.js'\nimport { useDocumentInfo } from '../../providers/DocumentInfo/index.js'\nimport { useTranslation } from '../../providers/Translation/index.js'\nimport { requests } from '../../utilities/api.js'\nimport { Button } from '../Button/index.js'\nimport { PopupList } from '../Popup/index.js'\nimport { Translation } from '../Translation/index.js'\nimport './index.scss'\n\nconst baseClass = 'delete-document'\n\nexport type Props = {\n  buttonId?: string\n  collectionSlug: SanitizedCollectionConfig['slug']\n  id?: string\n  singularLabel: SanitizedCollectionConfig['labels']['singular']\n  title?: string\n  useAsTitle: SanitizedCollectionConfig['admin']['useAsTitle']\n}\n\nexport const DeleteDocument: React.FC<Props> = (props) => {\n  const { id, buttonId, collectionSlug, singularLabel, title: titleFromProps } = props\n\n  const {\n    routes: { admin, api },\n    serverURL,\n  } = useConfig()\n\n  const { setModified } = useForm()\n  const [deleting, setDeleting] = useState(false)\n  const { toggleModal } = useModal()\n  const router = useRouter()\n  const { i18n, t } = useTranslation()\n  const { title } = useDocumentInfo()\n\n  const titleToRender = titleFromProps || title || id\n\n  const modalSlug = `delete-${id}`\n\n  const addDefaultError = useCallback(() => {\n    setDeleting(false)\n    toast.error(t('error:deletingTitle', { title }))\n  }, [t, title])\n\n  const handleDelete = useCallback(async () => {\n    setDeleting(true)\n    setModified(false)\n    try {\n      await requests\n        .delete(`${serverURL}${api}/${collectionSlug}/${id}`, {\n          headers: {\n            'Accept-Language': i18n.language,\n            'Content-Type': 'application/json',\n          },\n        })\n        .then(async (res) => {\n          try {\n            const json = await res.json()\n\n            if (res.status < 400) {\n              setDeleting(false)\n              toggleModal(modalSlug)\n              toast.success(\n                t('general:titleDeleted', { label: getTranslation(singularLabel, i18n), title }) ||\n                  json.message,\n              )\n\n              return router.push(`${admin}/collections/${collectionSlug}`)\n            }\n            toggleModal(modalSlug)\n            if (json.errors) {\n              json.errors.forEach((error) => toast.error(error.message))\n            } else {\n              addDefaultError()\n            }\n            return false\n          } catch (e) {\n            return addDefaultError()\n          }\n        })\n    } catch (e) {\n      addDefaultError()\n    }\n  }, [\n    setModified,\n    serverURL,\n    api,\n    collectionSlug,\n    id,\n    toggleModal,\n    modalSlug,\n    t,\n    singularLabel,\n    i18n,\n    title,\n    router,\n    admin,\n    addDefaultError,\n  ])\n\n  if (id) {\n    return (\n      <React.Fragment>\n        <PopupList.Button\n          id={buttonId}\n          onClick={() => {\n            setDeleting(false)\n            toggleModal(modalSlug)\n          }}\n        >\n          {t('general:delete')}\n        </PopupList.Button>\n        <Modal className={baseClass} slug={modalSlug}>\n          <div className={`${baseClass}__template`}>\n            <h1>{t('general:confirmDeletion')}</h1>\n            <p>\n              <Translation\n                elements={{\n                  '1': ({ children }) => <strong>{children}</strong>,\n                }}\n                i18nKey=\"general:aboutToDelete\"\n                t={t}\n                variables={{\n                  label: getTranslation(singularLabel, i18n),\n                  title: titleToRender,\n                }}\n              />\n            </p>\n            <div className={`${baseClass}__actions`}>\n              <Button\n                buttonStyle=\"secondary\"\n                id=\"confirm-cancel\"\n                onClick={deleting ? undefined : () => toggleModal(modalSlug)}\n                type=\"button\"\n              >\n                {t('general:cancel')}\n              </Button>\n              <Button id=\"confirm-delete\" onClick={deleting ? undefined : handleDelete}>\n                {deleting ? t('general:deleting') : t('general:confirm')}\n              </Button>\n            </div>\n          </div>\n        </Modal>\n      </React.Fragment>\n    )\n  }\n\n  return null\n}\n"],"names":["Modal","useModal","getTranslation","useRouter","React","useCallback","useState","toast","useForm","useConfig","useDocumentInfo","useTranslation","requests","Button","PopupList","Translation","baseClass","DeleteDocument","props","id","buttonId","collectionSlug","singularLabel","title","titleFromProps","routes","admin","api","serverURL","setModified","deleting","setDeleting","toggleModal","router","i18n","t","titleToRender","modalSlug","addDefaultError","error","handleDelete","delete","headers","language","then","res","json","status","success","label","message","push","errors","forEach","e","Fragment","onClick","className","slug","div","h1","p","elements","children","strong","i18nKey","variables","buttonStyle","undefined","type"],"mappings":"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"}