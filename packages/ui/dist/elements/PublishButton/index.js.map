{"version":3,"sources":["../../../src/elements/PublishButton/index.tsx"],"sourcesContent":["'use client'\n\nimport React, { useCallback } from 'react'\n\nimport { useForm, useFormModified } from '../../forms/Form/context.js'\nimport { FormSubmit } from '../../forms/Submit/index.js'\nimport { useHotkey } from '../../hooks/useHotkey.js'\nimport { useDocumentInfo } from '../../providers/DocumentInfo/index.js'\nimport { useEditDepth } from '../../providers/EditDepth/index.js'\nimport { useTranslation } from '../../providers/Translation/index.js'\n\nexport const DefaultPublishButton: React.FC<{ label?: string }> = ({ label: labelProp }) => {\n  const { hasPublishPermission, publishedDoc, unpublishedVersions } = useDocumentInfo()\n\n  const { submit } = useForm()\n  const modified = useFormModified()\n  const editDepth = useEditDepth()\n\n  const { t } = useTranslation()\n  const label = labelProp || t('version:publishChanges')\n\n  const hasNewerVersions = unpublishedVersions?.totalDocs > 0\n  const canPublish = hasPublishPermission && (modified || hasNewerVersions || !publishedDoc)\n\n  useHotkey({ cmdCtrlKey: true, editDepth, keyCodes: ['s'] }, (e) => {\n    e.preventDefault()\n    e.stopPropagation()\n\n    if (submit) {\n      void submit()\n    }\n  })\n\n  const publish = useCallback(() => {\n    void submit({\n      overrides: {\n        _status: 'published',\n      },\n    })\n  }, [submit])\n\n  if (!hasPublishPermission) return null\n\n  return (\n    <FormSubmit\n      buttonId=\"action-save\"\n      disabled={!canPublish}\n      onClick={publish}\n      size=\"small\"\n      type=\"button\"\n    >\n      {label}\n    </FormSubmit>\n  )\n}\n\ntype Props = {\n  CustomComponent?: React.ReactNode\n}\n\nexport const PublishButton: React.FC<Props> = ({ CustomComponent }) => {\n  if (CustomComponent) return CustomComponent\n  return <DefaultPublishButton />\n}\n"],"names":["React","useCallback","useForm","useFormModified","FormSubmit","useHotkey","useDocumentInfo","useEditDepth","useTranslation","DefaultPublishButton","label","labelProp","hasPublishPermission","publishedDoc","unpublishedVersions","submit","modified","editDepth","t","hasNewerVersions","totalDocs","canPublish","cmdCtrlKey","keyCodes","e","preventDefault","stopPropagation","publish","overrides","_status","buttonId","disabled","onClick","size","type","PublishButton","CustomComponent"],"mappings":"AAAA;;AAEA,OAAOA,SAASC,WAAW,QAAQ,QAAO;AAE1C,SAASC,OAAO,EAAEC,eAAe,QAAQ,8BAA6B;AACtE,SAASC,UAAU,QAAQ,8BAA6B;AACxD,SAASC,SAAS,QAAQ,2BAA0B;AACpD,SAASC,eAAe,QAAQ,wCAAuC;AACvE,SAASC,YAAY,QAAQ,qCAAoC;AACjE,SAASC,cAAc,QAAQ,uCAAsC;AAErE,OAAO,MAAMC,uBAAqD,CAAC,EAAEC,OAAOC,SAAS,EAAE;IACrF,MAAM,EAAEC,oBAAoB,EAAEC,YAAY,EAAEC,mBAAmB,EAAE,GAAGR;IAEpE,MAAM,EAAES,MAAM,EAAE,GAAGb;IACnB,MAAMc,WAAWb;IACjB,MAAMc,YAAYV;IAElB,MAAM,EAAEW,CAAC,EAAE,GAAGV;IACd,MAAME,QAAQC,aAAaO,EAAE;IAE7B,MAAMC,mBAAmBL,qBAAqBM,YAAY;IAC1D,MAAMC,aAAaT,wBAAyBI,CAAAA,YAAYG,oBAAoB,CAACN,YAAW;IAExFR,UAAU;QAAEiB,YAAY;QAAML;QAAWM,UAAU;YAAC;SAAI;IAAC,GAAG,CAACC;QAC3DA,EAAEC,cAAc;QAChBD,EAAEE,eAAe;QAEjB,IAAIX,QAAQ;YACV,KAAKA;QACP;IACF;IAEA,MAAMY,UAAU1B,YAAY;QAC1B,KAAKc,OAAO;YACVa,WAAW;gBACTC,SAAS;YACX;QACF;IACF,GAAG;QAACd;KAAO;IAEX,IAAI,CAACH,sBAAsB,OAAO;IAElC,qBACE,KAACR;QACC0B,UAAS;QACTC,UAAU,CAACV;QACXW,SAASL;QACTM,MAAK;QACLC,MAAK;kBAEJxB;;AAGP,EAAC;AAMD,OAAO,MAAMyB,gBAAiC,CAAC,EAAEC,eAAe,EAAE;IAChE,IAAIA,iBAAiB,OAAOA;IAC5B,qBAAO,KAAC3B;AACV,EAAC"}