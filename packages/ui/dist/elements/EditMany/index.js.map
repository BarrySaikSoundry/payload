{"version":3,"sources":["../../../src/elements/EditMany/index.tsx"],"sourcesContent":["'use client'\nimport type { ClientCollectionConfig, FormState } from 'payload'\n\nimport { useModal } from '@faceless-ui/modal'\nimport { getTranslation } from '@payloadcms/translations'\nimport { useRouter } from 'next/navigation.js'\nimport React, { useCallback, useState } from 'react'\n\nimport type { FormProps } from '../../forms/Form/index.js'\n\nimport { useForm } from '../../forms/Form/context.js'\nimport { Form } from '../../forms/Form/index.js'\nimport { RenderFields } from '../../forms/RenderFields/index.js'\nimport { FormSubmit } from '../../forms/Submit/index.js'\nimport { XIcon } from '../../icons/X/index.js'\nimport { useAuth } from '../../providers/Auth/index.js'\nimport { useConfig } from '../../providers/Config/index.js'\nimport { DocumentInfoProvider } from '../../providers/DocumentInfo/index.js'\nimport { OperationContext } from '../../providers/Operation/index.js'\nimport { useRouteCache } from '../../providers/RouteCache/index.js'\nimport { useSearchParams } from '../../providers/SearchParams/index.js'\nimport { SelectAllStatus, useSelection } from '../../providers/Selection/index.js'\nimport { useTranslation } from '../../providers/Translation/index.js'\nimport { getFormState } from '../../utilities/getFormState.js'\nimport { Drawer, DrawerToggler } from '../Drawer/index.js'\nimport { FieldSelect } from '../FieldSelect/index.js'\nimport './index.scss'\n\nconst baseClass = 'edit-many'\n\nimport type { FieldMap } from '../../providers/ComponentMap/buildComponentMap/types.js'\n\nexport type EditManyProps = {\n  collection: ClientCollectionConfig\n  fieldMap: FieldMap\n}\n\nconst Submit: React.FC<{ action: string; disabled: boolean }> = ({ action, disabled }) => {\n  const { submit } = useForm()\n  const { t } = useTranslation()\n\n  const save = useCallback(() => {\n    void submit({\n      action,\n      method: 'PATCH',\n      skipValidation: true,\n    })\n  }, [action, submit])\n\n  return (\n    <FormSubmit className={`${baseClass}__save`} disabled={disabled} onClick={save}>\n      {t('general:save')}\n    </FormSubmit>\n  )\n}\n\nconst PublishButton: React.FC<{ action: string; disabled: boolean }> = ({ action, disabled }) => {\n  const { submit } = useForm()\n  const { t } = useTranslation()\n\n  const save = useCallback(() => {\n    void submit({\n      action,\n      method: 'PATCH',\n      overrides: {\n        _status: 'published',\n      },\n      skipValidation: true,\n    })\n  }, [action, submit])\n\n  return (\n    <FormSubmit className={`${baseClass}__publish`} disabled={disabled} onClick={save}>\n      {t('version:publishChanges')}\n    </FormSubmit>\n  )\n}\n\nconst SaveDraftButton: React.FC<{ action: string; disabled: boolean }> = ({ action, disabled }) => {\n  const { submit } = useForm()\n  const { t } = useTranslation()\n\n  const save = useCallback(() => {\n    void submit({\n      action,\n      method: 'PATCH',\n      overrides: {\n        _status: 'draft',\n      },\n      skipValidation: true,\n    })\n  }, [action, submit])\n\n  return (\n    <FormSubmit className={`${baseClass}__draft`} disabled={disabled} onClick={save}>\n      {t('version:saveDraft')}\n    </FormSubmit>\n  )\n}\nexport const EditMany: React.FC<EditManyProps> = (props) => {\n  const { collection: { slug, labels: { plural } } = {}, collection, fieldMap } = props\n\n  const { permissions } = useAuth()\n  const { closeModal } = useModal()\n  const {\n    routes: { api: apiRoute },\n    serverURL,\n  } = useConfig()\n  const { count, getQueryParams, selectAll } = useSelection()\n  const { i18n, t } = useTranslation()\n  const [selected, setSelected] = useState([])\n  const { stringifyParams } = useSearchParams()\n  const router = useRouter()\n  const [initialState, setInitialState] = useState<FormState>()\n  const hasInitializedState = React.useRef(false)\n  const { clearRouteCache } = useRouteCache()\n\n  const collectionPermissions = permissions?.collections?.[slug]\n  const hasUpdatePermission = collectionPermissions?.update?.permission\n\n  const drawerSlug = `edit-${slug}`\n\n  React.useEffect(() => {\n    if (!hasInitializedState.current) {\n      const getInitialState = async () => {\n        const result = await getFormState({\n          apiRoute,\n          body: {\n            collectionSlug: slug,\n            data: {},\n            operation: 'update',\n            schemaPath: slug,\n          },\n          serverURL,\n        })\n\n        setInitialState(result)\n        hasInitializedState.current = true\n      }\n\n      void getInitialState()\n    }\n  }, [apiRoute, hasInitializedState, serverURL, slug])\n\n  const onChange: FormProps['onChange'][0] = useCallback(\n    ({ formState: prevFormState }) =>\n      getFormState({\n        apiRoute,\n        body: {\n          collectionSlug: slug,\n          formState: prevFormState,\n          operation: 'update',\n          schemaPath: slug,\n        },\n        serverURL,\n      }),\n    [serverURL, apiRoute, slug],\n  )\n\n  if (selectAll === SelectAllStatus.None || !hasUpdatePermission) {\n    return null\n  }\n\n  const onSuccess = () => {\n    router.replace(\n      stringifyParams({\n        params: { page: selectAll === SelectAllStatus.AllAvailable ? '1' : undefined },\n      }),\n    )\n    clearRouteCache()\n    closeModal(drawerSlug)\n  }\n\n  return (\n    <div className={baseClass}>\n      <DrawerToggler\n        aria-label={t('general:edit')}\n        className={`${baseClass}__toggle`}\n        onClick={() => {\n          setSelected([])\n        }}\n        slug={drawerSlug}\n      >\n        {t('general:edit')}\n      </DrawerToggler>\n      <Drawer Header={null} slug={drawerSlug}>\n        <DocumentInfoProvider collectionSlug={slug} id={null}>\n          <OperationContext.Provider value=\"update\">\n            <div className={`${baseClass}__main`}>\n              <div className={`${baseClass}__header`}>\n                <h2 className={`${baseClass}__header__title`}>\n                  {t('general:editingLabel', { count, label: getTranslation(plural, i18n) })}\n                </h2>\n                <button\n                  aria-label={t('general:close')}\n                  className={`${baseClass}__header__close`}\n                  id={`close-drawer__${drawerSlug}`}\n                  onClick={() => closeModal(drawerSlug)}\n                  type=\"button\"\n                >\n                  <XIcon />\n                </button>\n              </div>\n              <Form\n                className={`${baseClass}__form`}\n                initialState={initialState}\n                onChange={[onChange]}\n                onSuccess={onSuccess}\n              >\n                <FieldSelect fieldMap={fieldMap} setSelected={setSelected} />\n                {selected.length === 0 ? null : (\n                  <RenderFields fieldMap={selected} path=\"\" readOnly={false} schemaPath={slug} />\n                )}\n                <div className={`${baseClass}__sidebar-wrap`}>\n                  <div className={`${baseClass}__sidebar`}>\n                    <div className={`${baseClass}__sidebar-sticky-wrap`}>\n                      <div className={`${baseClass}__document-actions`}>\n                        {collection?.versions?.drafts ? (\n                          <React.Fragment>\n                            <PublishButton\n                              action={`${serverURL}${apiRoute}/${slug}${getQueryParams()}&draft=true`}\n                              disabled={selected.length === 0}\n                            />\n                            <SaveDraftButton\n                              action={`${serverURL}${apiRoute}/${slug}${getQueryParams()}&draft=true`}\n                              disabled={selected.length === 0}\n                            />\n                          </React.Fragment>\n                        ) : (\n                          <Submit\n                            action={`${serverURL}${apiRoute}/${slug}${getQueryParams()}`}\n                            disabled={selected.length === 0}\n                          />\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </Form>\n            </div>\n          </OperationContext.Provider>\n        </DocumentInfoProvider>\n      </Drawer>\n    </div>\n  )\n}\n"],"names":["useModal","getTranslation","useRouter","React","useCallback","useState","useForm","Form","RenderFields","FormSubmit","XIcon","useAuth","useConfig","DocumentInfoProvider","OperationContext","useRouteCache","useSearchParams","SelectAllStatus","useSelection","useTranslation","getFormState","Drawer","DrawerToggler","FieldSelect","baseClass","Submit","action","disabled","submit","t","save","method","skipValidation","className","onClick","PublishButton","overrides","_status","SaveDraftButton","EditMany","props","collection","slug","labels","plural","fieldMap","permissions","closeModal","routes","api","apiRoute","serverURL","count","getQueryParams","selectAll","i18n","selected","setSelected","stringifyParams","router","initialState","setInitialState","hasInitializedState","useRef","clearRouteCache","collectionPermissions","collections","hasUpdatePermission","update","permission","drawerSlug","useEffect","current","getInitialState","result","body","collectionSlug","data","operation","schemaPath","onChange","formState","prevFormState","None","onSuccess","replace","params","page","AllAvailable","undefined","div","aria-label","Header","id","Provider","value","h2","label","button","type","length","path","readOnly","versions","drafts","Fragment"],"mappings":"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"}