{"version":3,"sources":["../../../../src/providers/ComponentMap/buildComponentMap/index.tsx"],"sourcesContent":["import type {\n  AdminViewProps,\n  EditViewProps,\n  Payload,\n  ServerProps,\n  WithServerSidePropsComponentProps,\n} from 'payload'\n\nimport React from 'react'\n\nimport type { ComponentMap } from './types.js'\n\nimport { WithServerSideProps as WithServerSidePropsGeneric } from '../../../elements/WithServerSideProps/index.js'\nimport { mapCollections } from './collections.js'\nimport { mapGlobals } from './globals.js'\n\nexport type WithServerSidePropsPrePopulated = React.FC<\n  Omit<WithServerSidePropsComponentProps, 'serverOnlyProps'>\n>\n\nexport const buildComponentMap = (args: {\n  DefaultEditView: React.FC<EditViewProps>\n  DefaultListView: React.FC<AdminViewProps>\n  children: React.ReactNode\n  i18n: ServerProps['i18n']\n  payload: Payload\n  readOnly?: boolean\n}): {\n  componentMap: ComponentMap\n  wrappedChildren: React.ReactNode\n} => {\n  const { DefaultEditView, DefaultListView, children, i18n, payload, readOnly } = args\n  const config = payload.config\n\n  const WithServerSideProps: WithServerSidePropsPrePopulated = ({ Component, ...rest }) => {\n    return (\n      <WithServerSidePropsGeneric\n        Component={Component}\n        serverOnlyProps={{\n          i18n,\n          payload,\n        }}\n        {...rest}\n      />\n    )\n  }\n\n  const collections = mapCollections({\n    DefaultEditView,\n    DefaultListView,\n    WithServerSideProps,\n    collections: config.collections,\n    config,\n    i18n,\n    readOnly,\n  })\n\n  const globals = mapGlobals({\n    args: {\n      DefaultEditView,\n      WithServerSideProps,\n      config,\n      globals: config.globals,\n      i18n,\n      readOnly,\n    },\n  })\n\n  const NestProviders = ({ children, providers }) => {\n    const Component = providers[0]\n    if (providers.length > 1) {\n      return (\n        <Component>\n          <NestProviders providers={providers.slice(1)}>{children}</NestProviders>\n        </Component>\n      )\n    }\n    return <Component>{children}</Component>\n  }\n\n  const LogoutButtonComponent = config.admin?.components?.logout?.Button\n\n  const LogoutButton = LogoutButtonComponent ? (\n    <WithServerSideProps Component={LogoutButtonComponent} />\n  ) : null\n\n  const IconComponent = config.admin?.components?.graphics?.Icon\n\n  const Icon = IconComponent ? <WithServerSideProps Component={IconComponent} /> : null\n\n  return {\n    componentMap: {\n      Icon,\n      LogoutButton,\n      actions: config.admin?.components?.actions?.map((Component, i) => (\n        <WithServerSideProps Component={Component} key={i} />\n      )),\n      collections,\n      globals,\n    },\n    wrappedChildren:\n      Array.isArray(config.admin?.components?.providers) &&\n      config.admin?.components?.providers.length > 0 ? (\n        <NestProviders providers={config.admin?.components?.providers}>{children}</NestProviders>\n      ) : (\n        children\n      ),\n  }\n}\n"],"names":["React","WithServerSideProps","WithServerSidePropsGeneric","mapCollections","mapGlobals","buildComponentMap","args","DefaultEditView","DefaultListView","children","i18n","payload","readOnly","config","Component","rest","serverOnlyProps","collections","globals","NestProviders","providers","length","slice","LogoutButtonComponent","admin","components","logout","Button","LogoutButton","IconComponent","graphics","Icon","componentMap","actions","map","i","wrappedChildren","Array","isArray"],"mappings":";AAQA,OAAOA,WAAW,QAAO;AAIzB,SAASC,uBAAuBC,0BAA0B,QAAQ,iDAAgD;AAClH,SAASC,cAAc,QAAQ,mBAAkB;AACjD,SAASC,UAAU,QAAQ,eAAc;AAMzC,OAAO,MAAMC,oBAAoB,CAACC;IAWhC,MAAM,EAAEC,eAAe,EAAEC,eAAe,EAAEC,QAAQ,EAAEC,IAAI,EAAEC,OAAO,EAAEC,QAAQ,EAAE,GAAGN;IAChF,MAAMO,SAASF,QAAQE,MAAM;IAE7B,MAAMZ,sBAAuD,CAAC,EAAEa,SAAS,EAAE,GAAGC,MAAM;QAClF,qBACE,KAACb;YACCY,WAAWA;YACXE,iBAAiB;gBACfN;gBACAC;YACF;YACC,GAAGI,IAAI;;IAGd;IAEA,MAAME,cAAcd,eAAe;QACjCI;QACAC;QACAP;QACAgB,aAAaJ,OAAOI,WAAW;QAC/BJ;QACAH;QACAE;IACF;IAEA,MAAMM,UAAUd,WAAW;QACzBE,MAAM;YACJC;YACAN;YACAY;YACAK,SAASL,OAAOK,OAAO;YACvBR;YACAE;QACF;IACF;IAEA,MAAMO,gBAAgB,CAAC,EAAEV,QAAQ,EAAEW,SAAS,EAAE;QAC5C,MAAMN,YAAYM,SAAS,CAAC,EAAE;QAC9B,IAAIA,UAAUC,MAAM,GAAG,GAAG;YACxB,qBACE,KAACP;0BACC,cAAA,KAACK;oBAAcC,WAAWA,UAAUE,KAAK,CAAC;8BAAKb;;;QAGrD;QACA,qBAAO,KAACK;sBAAWL;;IACrB;IAEA,MAAMc,wBAAwBV,OAAOW,KAAK,EAAEC,YAAYC,QAAQC;IAEhE,MAAMC,eAAeL,sCACnB,KAACtB;QAAoBa,WAAWS;SAC9B;IAEJ,MAAMM,gBAAgBhB,OAAOW,KAAK,EAAEC,YAAYK,UAAUC;IAE1D,MAAMA,OAAOF,8BAAgB,KAAC5B;QAAoBa,WAAWe;SAAoB;IAEjF,OAAO;QACLG,cAAc;YACZD;YACAH;YACAK,SAASpB,OAAOW,KAAK,EAAEC,YAAYQ,SAASC,IAAI,CAACpB,WAAWqB,kBAC1D,KAAClC;oBAAoBa,WAAWA;mBAAgBqB;YAElDlB;YACAC;QACF;QACAkB,iBACEC,MAAMC,OAAO,CAACzB,OAAOW,KAAK,EAAEC,YAAYL,cACxCP,OAAOW,KAAK,EAAEC,YAAYL,UAAUC,SAAS,kBAC3C,KAACF;YAAcC,WAAWP,OAAOW,KAAK,EAAEC,YAAYL;sBAAYX;aAEhEA;IAEN;AACF,EAAC"}