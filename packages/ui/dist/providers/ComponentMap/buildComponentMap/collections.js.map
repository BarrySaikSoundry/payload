{"version":3,"sources":["../../../../src/providers/ComponentMap/buildComponentMap/collections.tsx"],"sourcesContent":["import type { I18nClient } from '@payloadcms/translations'\nimport type {\n  AdminViewProps,\n  EditViewProps,\n  SanitizedCollectionConfig,\n  SanitizedConfig,\n} from 'payload'\n\nimport { isReactComponentOrFunction } from 'payload/shared'\nimport React from 'react'\n\nimport type { ViewDescriptionProps } from '../../../elements/ViewDescription/index.js'\nimport type { WithServerSidePropsPrePopulated } from './index.js'\nimport type { CollectionComponentMap } from './types.js'\n\n// Need to import from client barrel file\n// eslint-disable-next-line payload/no-imports-from-exports-dir\nimport { ViewDescription } from '../../../exports/client/index.js'\nimport { mapActions } from './actions.js'\nimport { mapFields } from './fields.js'\n\nexport const mapCollections = (args: {\n  DefaultEditView: React.FC<EditViewProps>\n  DefaultListView: React.FC<AdminViewProps>\n  WithServerSideProps: WithServerSidePropsPrePopulated\n  collections: SanitizedCollectionConfig[]\n  config: SanitizedConfig\n  i18n: I18nClient\n  readOnly?: boolean\n}): {\n  [key: SanitizedCollectionConfig['slug']]: CollectionComponentMap\n} => {\n  const {\n    DefaultEditView,\n    DefaultListView,\n    WithServerSideProps,\n    collections,\n    config,\n    i18n,\n    i18n: { t },\n    readOnly: readOnlyOverride,\n  } = args\n\n  return collections.reduce((acc, collectionConfig) => {\n    const { slug, fields } = collectionConfig\n\n    const internalCollections = ['payload-preferences', 'payload-migrations']\n\n    if (internalCollections.includes(slug)) {\n      return acc\n    }\n\n    const editViewFromConfig = collectionConfig?.admin?.components?.views?.Edit\n\n    const listViewFromConfig = collectionConfig?.admin?.components?.views?.List\n\n    const CustomEditView =\n      typeof editViewFromConfig === 'function'\n        ? editViewFromConfig\n        : typeof editViewFromConfig === 'object' &&\n            isReactComponentOrFunction(editViewFromConfig.Default)\n          ? editViewFromConfig.Default\n          : typeof editViewFromConfig?.Default === 'object' &&\n              'Component' in editViewFromConfig.Default &&\n              isReactComponentOrFunction(editViewFromConfig.Default.Component)\n            ? (editViewFromConfig.Default.Component as React.FC<EditViewProps>)\n            : undefined\n\n    const CustomListView =\n      typeof listViewFromConfig === 'function'\n        ? listViewFromConfig\n        : typeof listViewFromConfig === 'object' &&\n            isReactComponentOrFunction(listViewFromConfig.Component)\n          ? listViewFromConfig.Component\n          : undefined\n\n    const Edit = (CustomEditView as React.FC<EditViewProps>) || DefaultEditView\n\n    const List = CustomListView || DefaultListView\n\n    const SaveButtonComponent = collectionConfig?.admin?.components?.edit?.SaveButton\n\n    const SaveButton = SaveButtonComponent ? (\n      <WithServerSideProps Component={SaveButtonComponent} />\n    ) : undefined\n\n    const SaveDraftButtonComponent = collectionConfig?.admin?.components?.edit?.SaveDraftButton\n\n    const SaveDraftButton = SaveDraftButtonComponent ? (\n      <WithServerSideProps Component={SaveDraftButtonComponent} />\n    ) : undefined\n\n    const PreviewButtonComponent = collectionConfig?.admin?.components?.edit?.PreviewButton\n\n    const PreviewButton = PreviewButtonComponent ? (\n      <WithServerSideProps Component={PreviewButtonComponent} />\n    ) : undefined\n\n    const PublishButtonComponent = collectionConfig?.admin?.components?.edit?.PublishButton\n\n    const PublishButton = PublishButtonComponent ? (\n      <WithServerSideProps Component={PublishButtonComponent} />\n    ) : undefined\n\n    const UploadComponent = collectionConfig?.admin?.components?.edit?.Upload\n\n    const Upload = UploadComponent ? <WithServerSideProps Component={UploadComponent} /> : undefined\n\n    const beforeList = collectionConfig?.admin?.components?.beforeList\n\n    const BeforeList =\n      (beforeList &&\n        Array.isArray(beforeList) &&\n        beforeList?.map((Component, i) => <WithServerSideProps Component={Component} key={i} />)) ||\n      null\n\n    const beforeListTable = collectionConfig?.admin?.components?.beforeListTable\n\n    const BeforeListTable =\n      (beforeListTable &&\n        Array.isArray(beforeListTable) &&\n        beforeListTable?.map((Component, i) => (\n          <WithServerSideProps Component={Component} key={i} />\n        ))) ||\n      null\n\n    const afterList = collectionConfig?.admin?.components?.afterList\n\n    const AfterList =\n      (afterList &&\n        Array.isArray(afterList) &&\n        afterList?.map((Component, i) => <WithServerSideProps Component={Component} key={i} />)) ||\n      null\n\n    const afterListTable = collectionConfig?.admin?.components?.afterListTable\n\n    const AfterListTable =\n      (afterListTable &&\n        Array.isArray(afterListTable) &&\n        afterListTable?.map((Component, i) => (\n          <WithServerSideProps Component={Component} key={i} />\n        ))) ||\n      null\n\n    let description = undefined\n    if (collectionConfig.admin && 'description' in collectionConfig.admin) {\n      if (\n        typeof collectionConfig.admin?.description === 'string' ||\n        typeof collectionConfig.admin?.description === 'object'\n      ) {\n        description = collectionConfig.admin.description\n      } else if (typeof collectionConfig.admin?.description === 'function') {\n        description = collectionConfig.admin?.description({ t })\n      }\n    }\n\n    const descriptionProps: ViewDescriptionProps = {\n      description,\n    }\n\n    const DescriptionComponent =\n      collectionConfig.admin?.components?.edit?.Description ||\n      (description ? ViewDescription : undefined)\n\n    const Description =\n      DescriptionComponent !== undefined ? (\n        <WithServerSideProps Component={DescriptionComponent} {...(descriptionProps || {})} />\n      ) : undefined\n\n    const componentMap: CollectionComponentMap = {\n      AfterList,\n      AfterListTable,\n      BeforeList,\n      BeforeListTable,\n      Description,\n      Edit: <Edit collectionSlug={collectionConfig.slug} />,\n      List: <List collectionSlug={collectionConfig.slug} />,\n      PreviewButton,\n      PublishButton,\n      SaveButton,\n      SaveDraftButton,\n      Upload,\n      actionsMap: mapActions({\n        WithServerSideProps,\n        collectionConfig,\n      }),\n      fieldMap: mapFields({\n        WithServerSideProps,\n        config,\n        fieldSchema: fields,\n        i18n,\n        readOnly: readOnlyOverride,\n      }),\n      isPreviewEnabled: !!collectionConfig?.admin?.preview,\n    }\n\n    return {\n      ...acc,\n      [slug]: componentMap,\n    }\n  }, {})\n}\n"],"names":["isReactComponentOrFunction","React","ViewDescription","mapActions","mapFields","mapCollections","args","DefaultEditView","DefaultListView","WithServerSideProps","collections","config","i18n","t","readOnly","readOnlyOverride","reduce","acc","collectionConfig","slug","fields","internalCollections","includes","editViewFromConfig","admin","components","views","Edit","listViewFromConfig","List","CustomEditView","Default","Component","undefined","CustomListView","SaveButtonComponent","edit","SaveButton","SaveDraftButtonComponent","SaveDraftButton","PreviewButtonComponent","PreviewButton","PublishButtonComponent","PublishButton","UploadComponent","Upload","beforeList","BeforeList","Array","isArray","map","i","beforeListTable","BeforeListTable","afterList","AfterList","afterListTable","AfterListTable","description","descriptionProps","DescriptionComponent","Description","componentMap","collectionSlug","actionsMap","fieldMap","fieldSchema","isPreviewEnabled","preview"],"mappings":"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"}