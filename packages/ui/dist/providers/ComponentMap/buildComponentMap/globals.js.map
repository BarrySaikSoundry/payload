{"version":3,"sources":["../../../../src/providers/ComponentMap/buildComponentMap/globals.tsx"],"sourcesContent":["import type { I18nClient } from '@payloadcms/translations'\nimport type { EditViewProps, SanitizedConfig, SanitizedGlobalConfig } from 'payload'\n\nimport { isReactComponentOrFunction } from 'payload/shared'\nimport React from 'react'\n\nimport type { ViewDescriptionProps } from '../../../elements/ViewDescription/index.js'\nimport type { WithServerSidePropsPrePopulated } from './index.js'\nimport type { GlobalComponentMap } from './types.js'\n\n// Need to import from client barrel file\n// eslint-disable-next-line payload/no-imports-from-exports-dir\nimport { ViewDescription } from '../../../exports/client/index.js'\nimport { mapActions } from './actions.js'\nimport { mapFields } from './fields.js'\n\nexport const mapGlobals = ({\n  args,\n}: {\n  args: {\n    DefaultEditView: React.FC<EditViewProps>\n    WithServerSideProps: WithServerSidePropsPrePopulated\n    config: SanitizedConfig\n    globals: SanitizedGlobalConfig[]\n    i18n: I18nClient\n    readOnly?: boolean\n  }\n}): {\n  [key: SanitizedGlobalConfig['slug']]: GlobalComponentMap\n} => {\n  const {\n    DefaultEditView,\n    WithServerSideProps,\n    config,\n    globals,\n    i18n,\n    i18n: { t },\n    readOnly: readOnlyOverride,\n  } = args\n\n  return globals.reduce((acc, globalConfig) => {\n    const { slug, fields } = globalConfig\n\n    const editViewFromConfig = globalConfig?.admin?.components?.views?.Edit\n\n    const SaveButton = globalConfig?.admin?.components?.elements?.SaveButton\n\n    const SaveButtonComponent = SaveButton ? (\n      <WithServerSideProps Component={SaveButton} />\n    ) : undefined\n\n    const SaveDraftButton = globalConfig?.admin?.components?.elements?.SaveDraftButton\n\n    const SaveDraftButtonComponent = SaveDraftButton ? (\n      <WithServerSideProps Component={SaveDraftButton} />\n    ) : undefined\n\n    const PreviewButton = globalConfig?.admin?.components?.elements?.PreviewButton\n\n    const PreviewButtonComponent = PreviewButton ? (\n      <WithServerSideProps Component={PreviewButton} />\n    ) : undefined\n\n    const PublishButton = globalConfig?.admin?.components?.elements?.PublishButton\n\n    const PublishButtonComponent = PublishButton ? (\n      <WithServerSideProps Component={PublishButton} />\n    ) : undefined\n\n    const CustomEditView =\n      typeof editViewFromConfig === 'function'\n        ? editViewFromConfig\n        : typeof editViewFromConfig === 'object' &&\n            isReactComponentOrFunction(editViewFromConfig.Default)\n          ? editViewFromConfig.Default\n          : typeof editViewFromConfig?.Default === 'object' &&\n              'Component' in editViewFromConfig.Default &&\n              isReactComponentOrFunction(editViewFromConfig.Default.Component)\n            ? editViewFromConfig.Default.Component\n            : undefined\n\n    const Edit = (CustomEditView as React.FC<EditViewProps>) || DefaultEditView\n\n    let description = undefined\n    if (globalConfig.admin && 'description' in globalConfig.admin) {\n      if (\n        typeof globalConfig.admin?.description === 'string' ||\n        typeof globalConfig.admin?.description === 'object'\n      ) {\n        description = globalConfig.admin.description\n      } else if (typeof globalConfig.admin?.description === 'function') {\n        description = globalConfig.admin?.description({ t })\n      }\n    }\n\n    const descriptionProps: ViewDescriptionProps = {\n      description,\n    }\n    const DescriptionComponent =\n      globalConfig.admin?.components?.elements?.Description ||\n      (description ? ViewDescription : undefined)\n\n    const Description =\n      DescriptionComponent !== undefined ? (\n        <WithServerSideProps Component={DescriptionComponent} {...(descriptionProps || {})} />\n      ) : undefined\n\n    const componentMap: GlobalComponentMap = {\n      Description,\n      Edit: <Edit globalSlug={globalConfig.slug} />,\n      PreviewButton: PreviewButtonComponent,\n      PublishButton: PublishButtonComponent,\n      SaveButton: SaveButtonComponent,\n      SaveDraftButton: SaveDraftButtonComponent,\n      Upload: null,\n      actionsMap: mapActions({\n        WithServerSideProps,\n        globalConfig,\n      }),\n      fieldMap: mapFields({\n        WithServerSideProps,\n        config,\n        fieldSchema: fields,\n        i18n,\n        readOnly: readOnlyOverride,\n      }),\n      isPreviewEnabled: !!globalConfig?.admin?.preview,\n    }\n\n    return {\n      ...acc,\n      [slug]: componentMap,\n    }\n  }, {})\n}\n"],"names":["isReactComponentOrFunction","React","ViewDescription","mapActions","mapFields","mapGlobals","args","DefaultEditView","WithServerSideProps","config","globals","i18n","t","readOnly","readOnlyOverride","reduce","acc","globalConfig","slug","fields","editViewFromConfig","admin","components","views","Edit","SaveButton","elements","SaveButtonComponent","Component","undefined","SaveDraftButton","SaveDraftButtonComponent","PreviewButton","PreviewButtonComponent","PublishButton","PublishButtonComponent","CustomEditView","Default","description","descriptionProps","DescriptionComponent","Description","componentMap","globalSlug","Upload","actionsMap","fieldMap","fieldSchema","isPreviewEnabled","preview"],"mappings":"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"}