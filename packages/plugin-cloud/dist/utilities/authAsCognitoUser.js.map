{"version":3,"sources":["../../src/utilities/authAsCognitoUser.ts"],"sourcesContent":["import type { CognitoUserSession } from 'amazon-cognito-identity-js'\n\nimport { AuthenticationDetails, CognitoUser, CognitoUserPool } from 'amazon-cognito-identity-js'\n\nlet sessionAndToken: CognitoUserSession | null = null\n\nexport const authAsCognitoUser = async (\n  username: string,\n  password: string,\n): Promise<CognitoUserSession> => {\n  // TODO: Check that isValid evaluates expiration\n  if (sessionAndToken?.isValid()) {\n    return sessionAndToken\n  }\n\n  const userPool = new CognitoUserPool({\n    ClientId: process.env.PAYLOAD_CLOUD_COGNITO_USER_POOL_CLIENT_ID,\n    UserPoolId: process.env.PAYLOAD_CLOUD_COGNITO_USER_POOL_ID,\n  })\n\n  const authenticationDetails = new AuthenticationDetails({\n    Password: password,\n    Username: username,\n  })\n\n  const cognitoUser = new CognitoUser({\n    Pool: userPool,\n    Username: username,\n  })\n\n  const result: CognitoUserSession = await new Promise((resolve, reject) => {\n    cognitoUser.authenticateUser(authenticationDetails, {\n      onFailure: (err) => {\n        reject(err)\n      },\n      onSuccess: (res) => {\n        resolve(res)\n      },\n    })\n  })\n\n  sessionAndToken = result\n\n  return sessionAndToken\n}\n"],"names":["AuthenticationDetails","CognitoUser","CognitoUserPool","sessionAndToken","authAsCognitoUser","username","password","isValid","userPool","ClientId","process","env","PAYLOAD_CLOUD_COGNITO_USER_POOL_CLIENT_ID","UserPoolId","PAYLOAD_CLOUD_COGNITO_USER_POOL_ID","authenticationDetails","Password","Username","cognitoUser","Pool","result","Promise","resolve","reject","authenticateUser","onFailure","err","onSuccess","res"],"mappings":"AAEA,SAASA,qBAAqB,EAAEC,WAAW,EAAEC,eAAe,QAAQ,6BAA4B;AAEhG,IAAIC,kBAA6C;AAEjD,OAAO,MAAMC,oBAAoB,OAC/BC,UACAC;IAEA,gDAAgD;IAChD,IAAIH,iBAAiBI,WAAW;QAC9B,OAAOJ;IACT;IAEA,MAAMK,WAAW,IAAIN,gBAAgB;QACnCO,UAAUC,QAAQC,GAAG,CAACC,yCAAyC;QAC/DC,YAAYH,QAAQC,GAAG,CAACG,kCAAkC;IAC5D;IAEA,MAAMC,wBAAwB,IAAIf,sBAAsB;QACtDgB,UAAUV;QACVW,UAAUZ;IACZ;IAEA,MAAMa,cAAc,IAAIjB,YAAY;QAClCkB,MAAMX;QACNS,UAAUZ;IACZ;IAEA,MAAMe,SAA6B,MAAM,IAAIC,QAAQ,CAACC,SAASC;QAC7DL,YAAYM,gBAAgB,CAACT,uBAAuB;YAClDU,WAAW,CAACC;gBACVH,OAAOG;YACT;YACAC,WAAW,CAACC;gBACVN,QAAQM;YACV;QACF;IACF;IAEAzB,kBAAkBiB;IAElB,OAAOjB;AACT,EAAC"}