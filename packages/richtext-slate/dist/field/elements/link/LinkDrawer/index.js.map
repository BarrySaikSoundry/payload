{"version":3,"sources":["../../../../../src/field/elements/link/LinkDrawer/index.tsx"],"sourcesContent":["'use client'\n\nimport type { FormProps } from '@payloadcms/ui'\n\nimport {\n  Drawer,\n  Form,\n  FormSubmit,\n  RenderFields,\n  useConfig,\n  useDocumentInfo,\n  useEditDepth,\n  useFieldProps,\n  useHotkey,\n  useTranslation,\n} from '@payloadcms/ui'\nimport { getFormState } from '@payloadcms/ui/shared'\nimport React, { useCallback, useRef } from 'react'\n\nimport type { Props } from './types.js'\n\nimport { linkFieldsSchemaPath } from '../shared.js'\nimport './index.scss'\n\nconst baseClass = 'rich-text-link-edit-modal'\n\nexport const LinkDrawer: React.FC<Props> = ({\n  drawerSlug,\n  fieldMap,\n  handleModalSubmit,\n  initialState,\n}) => {\n  const { t } = useTranslation()\n  const { schemaPath } = useFieldProps()\n  const fieldMapPath = `${schemaPath}.${linkFieldsSchemaPath}`\n  const { id } = useDocumentInfo()\n  const config = useConfig()\n\n  const onChange: FormProps['onChange'][0] = useCallback(\n    async ({ formState: prevFormState }) => {\n      return await getFormState({\n        apiRoute: config.routes.api,\n        body: {\n          id,\n          formState: prevFormState,\n          operation: 'update',\n          schemaPath: fieldMapPath,\n        },\n        serverURL: config.serverURL,\n      })\n    },\n\n    [config.routes.api, config.serverURL, fieldMapPath, id],\n  )\n\n  return (\n    <Drawer className={baseClass} slug={drawerSlug} title={t('fields:editLink')}>\n      <Form\n        beforeSubmit={[onChange]}\n        disableValidationOnSubmit\n        initialState={initialState}\n        onChange={[onChange]}\n        onSubmit={handleModalSubmit}\n      >\n        <RenderFields fieldMap={fieldMap} forceRender path=\"\" readOnly={false} schemaPath=\"\" />\n        <LinkSubmit />\n      </Form>\n    </Drawer>\n  )\n}\n\nconst LinkSubmit: React.FC = () => {\n  const { t } = useTranslation()\n  const ref = useRef<HTMLButtonElement>(null)\n  const editDepth = useEditDepth()\n\n  useHotkey({ cmdCtrlKey: true, editDepth, keyCodes: ['s'] }, (e) => {\n    e.preventDefault()\n    e.stopPropagation()\n    if (ref?.current) {\n      ref.current.click()\n    }\n  })\n\n  return <FormSubmit ref={ref}>{t('general:submit')}</FormSubmit>\n}\n"],"names":["Drawer","Form","FormSubmit","RenderFields","useConfig","useDocumentInfo","useEditDepth","useFieldProps","useHotkey","useTranslation","getFormState","React","useCallback","useRef","linkFieldsSchemaPath","baseClass","LinkDrawer","drawerSlug","fieldMap","handleModalSubmit","initialState","t","schemaPath","fieldMapPath","id","config","onChange","formState","prevFormState","apiRoute","routes","api","body","operation","serverURL","className","slug","title","beforeSubmit","disableValidationOnSubmit","onSubmit","forceRender","path","readOnly","LinkSubmit","ref","editDepth","cmdCtrlKey","keyCodes","e","preventDefault","stopPropagation","current","click"],"mappings":"AAAA;;AAIA,SACEA,MAAM,EACNC,IAAI,EACJC,UAAU,EACVC,YAAY,EACZC,SAAS,EACTC,eAAe,EACfC,YAAY,EACZC,aAAa,EACbC,SAAS,EACTC,cAAc,QACT,iBAAgB;AACvB,SAASC,YAAY,QAAQ,wBAAuB;AACpD,OAAOC,SAASC,WAAW,EAAEC,MAAM,QAAQ,QAAO;AAIlD,SAASC,oBAAoB,QAAQ,eAAc;AACnD,OAAO,eAAc;AAErB,MAAMC,YAAY;AAElB,OAAO,MAAMC,aAA8B,CAAC,EAC1CC,UAAU,EACVC,QAAQ,EACRC,iBAAiB,EACjBC,YAAY,EACb;IACC,MAAM,EAAEC,CAAC,EAAE,GAAGZ;IACd,MAAM,EAAEa,UAAU,EAAE,GAAGf;IACvB,MAAMgB,eAAe,CAAC,EAAED,WAAW,CAAC,EAAER,qBAAqB,CAAC;IAC5D,MAAM,EAAEU,EAAE,EAAE,GAAGnB;IACf,MAAMoB,SAASrB;IAEf,MAAMsB,WAAqCd,YACzC,OAAO,EAAEe,WAAWC,aAAa,EAAE;QACjC,OAAO,MAAMlB,aAAa;YACxBmB,UAAUJ,OAAOK,MAAM,CAACC,GAAG;YAC3BC,MAAM;gBACJR;gBACAG,WAAWC;gBACXK,WAAW;gBACXX,YAAYC;YACd;YACAW,WAAWT,OAAOS,SAAS;QAC7B;IACF,GAEA;QAACT,OAAOK,MAAM,CAACC,GAAG;QAAEN,OAAOS,SAAS;QAAEX;QAAcC;KAAG;IAGzD,qBACE,KAACxB;QAAOmC,WAAWpB;QAAWqB,MAAMnB;QAAYoB,OAAOhB,EAAE;kBACvD,cAAA,MAACpB;YACCqC,cAAc;gBAACZ;aAAS;YACxBa,yBAAyB;YACzBnB,cAAcA;YACdM,UAAU;gBAACA;aAAS;YACpBc,UAAUrB;;8BAEV,KAAChB;oBAAae,UAAUA;oBAAUuB,WAAW;oBAACC,MAAK;oBAAGC,UAAU;oBAAOrB,YAAW;;8BAClF,KAACsB;;;;AAIT,EAAC;AAED,MAAMA,aAAuB;IAC3B,MAAM,EAAEvB,CAAC,EAAE,GAAGZ;IACd,MAAMoC,MAAMhC,OAA0B;IACtC,MAAMiC,YAAYxC;IAElBE,UAAU;QAAEuC,YAAY;QAAMD;QAAWE,UAAU;YAAC;SAAI;IAAC,GAAG,CAACC;QAC3DA,EAAEC,cAAc;QAChBD,EAAEE,eAAe;QACjB,IAAIN,KAAKO,SAAS;YAChBP,IAAIO,OAAO,CAACC,KAAK;QACnB;IACF;IAEA,qBAAO,KAACnD;QAAW2C,KAAKA;kBAAMxB,EAAE;;AAClC"}