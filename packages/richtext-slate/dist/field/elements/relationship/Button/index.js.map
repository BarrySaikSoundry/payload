{"version":3,"sources":["../../../../../src/field/elements/relationship/Button/index.tsx"],"sourcesContent":["'use client'\n\nimport { useListDrawer, useTranslation } from '@payloadcms/ui'\nimport React, { Fragment, useCallback, useEffect, useState } from 'react'\nimport { ReactEditor, useSlate } from 'slate-react'\n\nimport { RelationshipIcon } from '../../../icons/Relationship/index.js'\nimport { ElementButton } from '../../Button.js'\nimport { EnabledRelationshipsCondition } from '../../EnabledRelationshipsCondition.js'\nimport { injectVoidElement } from '../../injectVoid.js'\nimport './index.scss'\n\nconst baseClass = 'relationship-rich-text-button'\n\nconst insertRelationship = (editor, { relationTo, value }) => {\n  const text = { text: ' ' }\n\n  const relationship = {\n    type: 'relationship',\n    children: [text],\n    relationTo,\n    value,\n  }\n\n  injectVoidElement(editor, relationship)\n\n  ReactEditor.focus(editor)\n}\n\ntype Props = {\n  enabledCollectionSlugs: string[]\n  path: string\n}\nconst RelationshipButton: React.FC<Props> = ({ enabledCollectionSlugs }) => {\n  const { t } = useTranslation()\n  const editor = useSlate()\n  const [selectedCollectionSlug, setSelectedCollectionSlug] = useState(\n    () => enabledCollectionSlugs[0],\n  )\n  const [ListDrawer, ListDrawerToggler, { closeDrawer, isDrawerOpen }] = useListDrawer({\n    collectionSlugs: enabledCollectionSlugs,\n    selectedCollection: selectedCollectionSlug,\n  })\n\n  const onSelect = useCallback(\n    ({ collectionSlug, docID }) => {\n      insertRelationship(editor, {\n        relationTo: collectionSlug,\n        value: {\n          id: docID,\n        },\n      })\n      closeDrawer()\n    },\n    [editor, closeDrawer],\n  )\n\n  useEffect(() => {\n    // always reset back to first option\n    // TODO: this is not working, see the ListDrawer component\n    setSelectedCollectionSlug(enabledCollectionSlugs[0])\n  }, [isDrawerOpen, enabledCollectionSlugs])\n\n  return (\n    <Fragment>\n      <ListDrawerToggler>\n        <ElementButton\n          className={baseClass}\n          el=\"div\"\n          format=\"relationship\"\n          onClick={() => {\n            // do nothing\n          }}\n          tooltip={t('fields:addRelationship')}\n        >\n          <RelationshipIcon />\n        </ElementButton>\n      </ListDrawerToggler>\n      <ListDrawer onSelect={onSelect} />\n    </Fragment>\n  )\n}\n\nexport const Button = (props: Props): React.ReactNode => {\n  return (\n    <EnabledRelationshipsCondition {...props}>\n      <RelationshipButton {...props} />\n    </EnabledRelationshipsCondition>\n  )\n}\n"],"names":["useListDrawer","useTranslation","React","Fragment","useCallback","useEffect","useState","ReactEditor","useSlate","RelationshipIcon","ElementButton","EnabledRelationshipsCondition","injectVoidElement","baseClass","insertRelationship","editor","relationTo","value","text","relationship","type","children","focus","RelationshipButton","enabledCollectionSlugs","t","selectedCollectionSlug","setSelectedCollectionSlug","ListDrawer","ListDrawerToggler","closeDrawer","isDrawerOpen","collectionSlugs","selectedCollection","onSelect","collectionSlug","docID","id","className","el","format","onClick","tooltip","Button","props"],"mappings":"AAAA;;AAEA,SAASA,aAAa,EAAEC,cAAc,QAAQ,iBAAgB;AAC9D,OAAOC,SAASC,QAAQ,EAAEC,WAAW,EAAEC,SAAS,EAAEC,QAAQ,QAAQ,QAAO;AACzE,SAASC,WAAW,EAAEC,QAAQ,QAAQ,cAAa;AAEnD,SAASC,gBAAgB,QAAQ,uCAAsC;AACvE,SAASC,aAAa,QAAQ,kBAAiB;AAC/C,SAASC,6BAA6B,QAAQ,yCAAwC;AACtF,SAASC,iBAAiB,QAAQ,sBAAqB;AACvD,OAAO,eAAc;AAErB,MAAMC,YAAY;AAElB,MAAMC,qBAAqB,CAACC,QAAQ,EAAEC,UAAU,EAAEC,KAAK,EAAE;IACvD,MAAMC,OAAO;QAAEA,MAAM;IAAI;IAEzB,MAAMC,eAAe;QACnBC,MAAM;QACNC,UAAU;YAACH;SAAK;QAChBF;QACAC;IACF;IAEAL,kBAAkBG,QAAQI;IAE1BZ,YAAYe,KAAK,CAACP;AACpB;AAMA,MAAMQ,qBAAsC,CAAC,EAAEC,sBAAsB,EAAE;IACrE,MAAM,EAAEC,CAAC,EAAE,GAAGxB;IACd,MAAMc,SAASP;IACf,MAAM,CAACkB,wBAAwBC,0BAA0B,GAAGrB,SAC1D,IAAMkB,sBAAsB,CAAC,EAAE;IAEjC,MAAM,CAACI,YAAYC,mBAAmB,EAAEC,WAAW,EAAEC,YAAY,EAAE,CAAC,GAAG/B,cAAc;QACnFgC,iBAAiBR;QACjBS,oBAAoBP;IACtB;IAEA,MAAMQ,WAAW9B,YACf,CAAC,EAAE+B,cAAc,EAAEC,KAAK,EAAE;QACxBtB,mBAAmBC,QAAQ;YACzBC,YAAYmB;YACZlB,OAAO;gBACLoB,IAAID;YACN;QACF;QACAN;IACF,GACA;QAACf;QAAQe;KAAY;IAGvBzB,UAAU;QACR,oCAAoC;QACpC,0DAA0D;QAC1DsB,0BAA0BH,sBAAsB,CAAC,EAAE;IACrD,GAAG;QAACO;QAAcP;KAAuB;IAEzC,qBACE,MAACrB;;0BACC,KAAC0B;0BACC,cAAA,KAACnB;oBACC4B,WAAWzB;oBACX0B,IAAG;oBACHC,QAAO;oBACPC,SAAS;oBACP,aAAa;oBACf;oBACAC,SAASjB,EAAE;8BAEX,cAAA,KAAChB;;;0BAGL,KAACmB;gBAAWM,UAAUA;;;;AAG5B;AAEA,OAAO,MAAMS,SAAS,CAACC;IACrB,qBACE,KAACjC;QAA+B,GAAGiC,KAAK;kBACtC,cAAA,KAACrB;YAAoB,GAAGqB,KAAK;;;AAGnC,EAAC"}