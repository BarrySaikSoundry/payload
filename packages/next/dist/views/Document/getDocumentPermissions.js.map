{"version":3,"sources":["../../../src/views/Document/getDocumentPermissions.tsx"],"sourcesContent":["import type {\n  Data,\n  DocumentPermissions,\n  PayloadRequest,\n  SanitizedCollectionConfig,\n  SanitizedGlobalConfig,\n} from 'payload'\n\nimport {\n  hasSavePermission as getHasSavePermission,\n  isEditing as getIsEditing,\n} from '@payloadcms/ui/shared'\nimport { docAccessOperation, docAccessOperationGlobal } from 'payload'\n\nexport const getDocumentPermissions = async (args: {\n  collectionConfig?: SanitizedCollectionConfig\n  data: Data\n  globalConfig?: SanitizedGlobalConfig\n  id?: number | string\n  req: PayloadRequest\n}): Promise<{\n  docPermissions: DocumentPermissions\n  hasPublishPermission: boolean\n  hasSavePermission: boolean\n}> => {\n  const { id, collectionConfig, data = {}, globalConfig, req } = args\n\n  let docPermissions: DocumentPermissions\n  let hasPublishPermission = false\n\n  if (collectionConfig) {\n    try {\n      docPermissions = await docAccessOperation({\n        id: id?.toString(),\n        collection: {\n          config: collectionConfig,\n        },\n        req: {\n          ...req,\n          data,\n        },\n      })\n\n      if (collectionConfig.versions?.drafts) {\n        hasPublishPermission = await docAccessOperation({\n          id: id?.toString(),\n          collection: {\n            config: collectionConfig,\n          },\n          req: {\n            ...req,\n            data: {\n              ...data,\n              _status: 'published',\n            },\n          },\n        }).then(({ update }) => update?.permission)\n      }\n    } catch (error) {\n      console.error(error) // eslint-disable-line no-console\n    }\n  }\n\n  if (globalConfig) {\n    try {\n      docPermissions = await docAccessOperationGlobal({\n        globalConfig,\n        req: {\n          ...req,\n          data,\n        },\n      })\n\n      if (globalConfig.versions?.drafts) {\n        hasPublishPermission = await docAccessOperationGlobal({\n          globalConfig,\n          req: {\n            ...req,\n            data: {\n              ...data,\n              _status: 'published',\n            },\n          },\n        }).then(({ update }) => update?.permission)\n      }\n    } catch (error) {\n      console.error(error) // eslint-disable-line no-console\n    }\n  }\n\n  const hasSavePermission = getHasSavePermission({\n    collectionSlug: collectionConfig?.slug,\n    docPermissions,\n    globalSlug: globalConfig?.slug,\n    isEditing: getIsEditing({\n      id,\n      collectionSlug: collectionConfig?.slug,\n      globalSlug: globalConfig?.slug,\n    }),\n  })\n\n  return {\n    docPermissions,\n    hasPublishPermission,\n    hasSavePermission,\n  }\n}\n"],"names":["hasSavePermission","getHasSavePermission","isEditing","getIsEditing","docAccessOperation","docAccessOperationGlobal","getDocumentPermissions","args","id","collectionConfig","data","globalConfig","req","docPermissions","hasPublishPermission","toString","collection","config","versions","drafts","_status","then","update","permission","error","console","collectionSlug","slug","globalSlug"],"mappings":"AAQA,SACEA,qBAAqBC,oBAAoB,EACzCC,aAAaC,YAAY,QACpB,wBAAuB;AAC9B,SAASC,kBAAkB,EAAEC,wBAAwB,QAAQ,UAAS;AAEtE,OAAO,MAAMC,yBAAyB,OAAOC;IAW3C,MAAM,EAAEC,EAAE,EAAEC,gBAAgB,EAAEC,OAAO,CAAC,CAAC,EAAEC,YAAY,EAAEC,GAAG,EAAE,GAAGL;IAE/D,IAAIM;IACJ,IAAIC,uBAAuB;IAE3B,IAAIL,kBAAkB;QACpB,IAAI;YACFI,iBAAiB,MAAMT,mBAAmB;gBACxCI,IAAIA,IAAIO;gBACRC,YAAY;oBACVC,QAAQR;gBACV;gBACAG,KAAK;oBACH,GAAGA,GAAG;oBACNF;gBACF;YACF;YAEA,IAAID,iBAAiBS,QAAQ,EAAEC,QAAQ;gBACrCL,uBAAuB,MAAMV,mBAAmB;oBAC9CI,IAAIA,IAAIO;oBACRC,YAAY;wBACVC,QAAQR;oBACV;oBACAG,KAAK;wBACH,GAAGA,GAAG;wBACNF,MAAM;4BACJ,GAAGA,IAAI;4BACPU,SAAS;wBACX;oBACF;gBACF,GAAGC,IAAI,CAAC,CAAC,EAAEC,MAAM,EAAE,GAAKA,QAAQC;YAClC;QACF,EAAE,OAAOC,OAAO;YACdC,QAAQD,KAAK,CAACA,OAAO,iCAAiC;;QACxD;IACF;IAEA,IAAIb,cAAc;QAChB,IAAI;YACFE,iBAAiB,MAAMR,yBAAyB;gBAC9CM;gBACAC,KAAK;oBACH,GAAGA,GAAG;oBACNF;gBACF;YACF;YAEA,IAAIC,aAAaO,QAAQ,EAAEC,QAAQ;gBACjCL,uBAAuB,MAAMT,yBAAyB;oBACpDM;oBACAC,KAAK;wBACH,GAAGA,GAAG;wBACNF,MAAM;4BACJ,GAAGA,IAAI;4BACPU,SAAS;wBACX;oBACF;gBACF,GAAGC,IAAI,CAAC,CAAC,EAAEC,MAAM,EAAE,GAAKA,QAAQC;YAClC;QACF,EAAE,OAAOC,OAAO;YACdC,QAAQD,KAAK,CAACA,OAAO,iCAAiC;;QACxD;IACF;IAEA,MAAMxB,oBAAoBC,qBAAqB;QAC7CyB,gBAAgBjB,kBAAkBkB;QAClCd;QACAe,YAAYjB,cAAcgB;QAC1BzB,WAAWC,aAAa;YACtBK;YACAkB,gBAAgBjB,kBAAkBkB;YAClCC,YAAYjB,cAAcgB;QAC5B;IACF;IAEA,OAAO;QACLd;QACAC;QACAd;IACF;AACF,EAAC"}