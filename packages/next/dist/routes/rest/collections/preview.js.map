{"version":3,"sources":["../../../../src/routes/rest/collections/preview.ts"],"sourcesContent":["import httpStatus from 'http-status'\nimport { extractJWT, findByIDOperation } from 'payload'\nimport { isNumber } from 'payload/shared'\n\nimport type { CollectionRouteHandlerWithID } from '../types.js'\n\nimport { headersWithCors } from '../../../utilities/headersWithCors.js'\nimport { routeError } from '../routeError.js'\n\nexport const preview: CollectionRouteHandlerWithID = async ({ id, collection, req }) => {\n  const { searchParams } = req\n  const depth = searchParams.get('depth')\n\n  const result = await findByIDOperation({\n    id,\n    collection,\n    depth: isNumber(depth) ? Number(depth) : undefined,\n    draft: searchParams.get('draft') === 'true',\n    req,\n  })\n\n  let previewURL: string\n\n  const generatePreviewURL = req.payload.config.collections.find(\n    (config) => config.slug === collection.config.slug,\n  )?.admin?.preview\n\n  const token = extractJWT(req)\n\n  if (typeof generatePreviewURL === 'function') {\n    try {\n      previewURL = await generatePreviewURL(result, {\n        locale: req.locale,\n        req,\n        token,\n      })\n    } catch (err) {\n      return routeError({\n        collection,\n        config: req.payload.config,\n        err,\n        req,\n      })\n    }\n  }\n\n  return Response.json(previewURL, {\n    headers: headersWithCors({\n      headers: new Headers(),\n      req,\n    }),\n    status: httpStatus.OK,\n  })\n}\n"],"names":["httpStatus","extractJWT","findByIDOperation","isNumber","headersWithCors","routeError","preview","id","collection","req","searchParams","depth","get","result","Number","undefined","draft","previewURL","generatePreviewURL","payload","config","collections","find","slug","admin","token","locale","err","Response","json","headers","Headers","status","OK"],"mappings":"AAAA,OAAOA,gBAAgB,cAAa;AACpC,SAASC,UAAU,EAAEC,iBAAiB,QAAQ,UAAS;AACvD,SAASC,QAAQ,QAAQ,iBAAgB;AAIzC,SAASC,eAAe,QAAQ,wCAAuC;AACvE,SAASC,UAAU,QAAQ,mBAAkB;AAE7C,OAAO,MAAMC,UAAwC,OAAO,EAAEC,EAAE,EAAEC,UAAU,EAAEC,GAAG,EAAE;IACjF,MAAM,EAAEC,YAAY,EAAE,GAAGD;IACzB,MAAME,QAAQD,aAAaE,GAAG,CAAC;IAE/B,MAAMC,SAAS,MAAMX,kBAAkB;QACrCK;QACAC;QACAG,OAAOR,SAASQ,SAASG,OAAOH,SAASI;QACzCC,OAAON,aAAaE,GAAG,CAAC,aAAa;QACrCH;IACF;IAEA,IAAIQ;IAEJ,MAAMC,qBAAqBT,IAAIU,OAAO,CAACC,MAAM,CAACC,WAAW,CAACC,IAAI,CAC5D,CAACF,SAAWA,OAAOG,IAAI,KAAKf,WAAWY,MAAM,CAACG,IAAI,GACjDC,OAAOlB;IAEV,MAAMmB,QAAQxB,WAAWQ;IAEzB,IAAI,OAAOS,uBAAuB,YAAY;QAC5C,IAAI;YACFD,aAAa,MAAMC,mBAAmBL,QAAQ;gBAC5Ca,QAAQjB,IAAIiB,MAAM;gBAClBjB;gBACAgB;YACF;QACF,EAAE,OAAOE,KAAK;YACZ,OAAOtB,WAAW;gBAChBG;gBACAY,QAAQX,IAAIU,OAAO,CAACC,MAAM;gBAC1BO;gBACAlB;YACF;QACF;IACF;IAEA,OAAOmB,SAASC,IAAI,CAACZ,YAAY;QAC/Ba,SAAS1B,gBAAgB;YACvB0B,SAAS,IAAIC;YACbtB;QACF;QACAuB,QAAQhC,WAAWiC,EAAE;IACvB;AACF,EAAC"}