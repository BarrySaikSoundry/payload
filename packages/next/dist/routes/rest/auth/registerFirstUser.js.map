{"version":3,"sources":["../../../../src/routes/rest/auth/registerFirstUser.ts"],"sourcesContent":["import httpStatus from 'http-status'\nimport { generatePayloadCookie, registerFirstUserOperation } from 'payload'\n\nimport type { CollectionRouteHandler } from '../types.js'\n\nimport { headersWithCors } from '../../../utilities/headersWithCors.js'\n\nexport const registerFirstUser: CollectionRouteHandler = async ({ collection, req }) => {\n  const { data, t } = req\n  const authData = collection.config.auth?.loginWithUsername\n    ? {\n        email: typeof req.data?.email === 'string' ? req.data.email : '',\n        password: typeof req.data?.password === 'string' ? req.data.password : '',\n        username: typeof req.data?.username === 'string' ? req.data.username : '',\n      }\n    : {\n        email: typeof req.data?.email === 'string' ? req.data.email : '',\n        password: typeof req.data?.password === 'string' ? req.data.password : '',\n      }\n\n  const result = await registerFirstUserOperation({\n    collection,\n    data: {\n      ...data,\n      ...authData,\n    },\n    req,\n  })\n\n  const cookie = generatePayloadCookie({\n    collectionConfig: collection.config,\n    payload: req.payload,\n    token: result.token,\n  })\n\n  return Response.json(\n    {\n      exp: result.exp,\n      message: t('authentication:successfullyRegisteredFirstUser'),\n      token: result.token,\n      user: result.user,\n    },\n    {\n      headers: headersWithCors({\n        headers: new Headers({\n          'Set-Cookie': cookie,\n        }),\n        req,\n      }),\n      status: httpStatus.OK,\n    },\n  )\n}\n"],"names":["httpStatus","generatePayloadCookie","registerFirstUserOperation","headersWithCors","registerFirstUser","collection","req","data","t","authData","config","auth","loginWithUsername","email","password","username","result","cookie","collectionConfig","payload","token","Response","json","exp","message","user","headers","Headers","status","OK"],"mappings":"AAAA,OAAOA,gBAAgB,cAAa;AACpC,SAASC,qBAAqB,EAAEC,0BAA0B,QAAQ,UAAS;AAI3E,SAASC,eAAe,QAAQ,wCAAuC;AAEvE,OAAO,MAAMC,oBAA4C,OAAO,EAAEC,UAAU,EAAEC,GAAG,EAAE;IACjF,MAAM,EAAEC,IAAI,EAAEC,CAAC,EAAE,GAAGF;IACpB,MAAMG,WAAWJ,WAAWK,MAAM,CAACC,IAAI,EAAEC,oBACrC;QACEC,OAAO,OAAOP,IAAIC,IAAI,EAAEM,UAAU,WAAWP,IAAIC,IAAI,CAACM,KAAK,GAAG;QAC9DC,UAAU,OAAOR,IAAIC,IAAI,EAAEO,aAAa,WAAWR,IAAIC,IAAI,CAACO,QAAQ,GAAG;QACvEC,UAAU,OAAOT,IAAIC,IAAI,EAAEQ,aAAa,WAAWT,IAAIC,IAAI,CAACQ,QAAQ,GAAG;IACzE,IACA;QACEF,OAAO,OAAOP,IAAIC,IAAI,EAAEM,UAAU,WAAWP,IAAIC,IAAI,CAACM,KAAK,GAAG;QAC9DC,UAAU,OAAOR,IAAIC,IAAI,EAAEO,aAAa,WAAWR,IAAIC,IAAI,CAACO,QAAQ,GAAG;IACzE;IAEJ,MAAME,SAAS,MAAMd,2BAA2B;QAC9CG;QACAE,MAAM;YACJ,GAAGA,IAAI;YACP,GAAGE,QAAQ;QACb;QACAH;IACF;IAEA,MAAMW,SAAShB,sBAAsB;QACnCiB,kBAAkBb,WAAWK,MAAM;QACnCS,SAASb,IAAIa,OAAO;QACpBC,OAAOJ,OAAOI,KAAK;IACrB;IAEA,OAAOC,SAASC,IAAI,CAClB;QACEC,KAAKP,OAAOO,GAAG;QACfC,SAAShB,EAAE;QACXY,OAAOJ,OAAOI,KAAK;QACnBK,MAAMT,OAAOS,IAAI;IACnB,GACA;QACEC,SAASvB,gBAAgB;YACvBuB,SAAS,IAAIC,QAAQ;gBACnB,cAAcV;YAChB;YACAX;QACF;QACAsB,QAAQ5B,WAAW6B,EAAE;IACvB;AAEJ,EAAC"}