{"version":3,"sources":["../../../../src/routes/rest/auth/refresh.ts"],"sourcesContent":["import httpStatus from 'http-status'\nimport { generatePayloadCookie, refreshOperation } from 'payload'\n\nimport type { CollectionRouteHandler } from '../types.js'\n\nimport { headersWithCors } from '../../../utilities/headersWithCors.js'\n\nexport const refresh: CollectionRouteHandler = async ({ collection, req }) => {\n  const { t } = req\n\n  const headers = headersWithCors({\n    headers: new Headers(),\n    req,\n  })\n\n  const result = await refreshOperation({\n    collection,\n    req,\n  })\n\n  if (result.setCookie) {\n    const cookie = generatePayloadCookie({\n      collectionConfig: collection.config,\n      payload: req.payload,\n      token: result.refreshedToken,\n    })\n\n    if (collection.config.auth.removeTokenFromResponses) {\n      delete result.refreshedToken\n    }\n\n    headers.set('Set-Cookie', cookie)\n  }\n\n  return Response.json(\n    {\n      message: t('authentication:tokenRefreshSuccessful'),\n      ...result,\n    },\n    {\n      headers,\n      status: httpStatus.OK,\n    },\n  )\n}\n"],"names":["httpStatus","generatePayloadCookie","refreshOperation","headersWithCors","refresh","collection","req","t","headers","Headers","result","setCookie","cookie","collectionConfig","config","payload","token","refreshedToken","auth","removeTokenFromResponses","set","Response","json","message","status","OK"],"mappings":"AAAA,OAAOA,gBAAgB,cAAa;AACpC,SAASC,qBAAqB,EAAEC,gBAAgB,QAAQ,UAAS;AAIjE,SAASC,eAAe,QAAQ,wCAAuC;AAEvE,OAAO,MAAMC,UAAkC,OAAO,EAAEC,UAAU,EAAEC,GAAG,EAAE;IACvE,MAAM,EAAEC,CAAC,EAAE,GAAGD;IAEd,MAAME,UAAUL,gBAAgB;QAC9BK,SAAS,IAAIC;QACbH;IACF;IAEA,MAAMI,SAAS,MAAMR,iBAAiB;QACpCG;QACAC;IACF;IAEA,IAAII,OAAOC,SAAS,EAAE;QACpB,MAAMC,SAASX,sBAAsB;YACnCY,kBAAkBR,WAAWS,MAAM;YACnCC,SAAST,IAAIS,OAAO;YACpBC,OAAON,OAAOO,cAAc;QAC9B;QAEA,IAAIZ,WAAWS,MAAM,CAACI,IAAI,CAACC,wBAAwB,EAAE;YACnD,OAAOT,OAAOO,cAAc;QAC9B;QAEAT,QAAQY,GAAG,CAAC,cAAcR;IAC5B;IAEA,OAAOS,SAASC,IAAI,CAClB;QACEC,SAAShB,EAAE;QACX,GAAGG,MAAM;IACX,GACA;QACEF;QACAgB,QAAQxB,WAAWyB,EAAE;IACvB;AAEJ,EAAC"}