{"version":3,"sources":["../src/withPayload.js"],"sourcesContent":["/**\n * @param {import('next').NextConfig} nextConfig\n *\n * @returns {import('next').NextConfig}\n * */\nexport const withPayload = (nextConfig = {}) => {\n  if (nextConfig.experimental?.staleTimes?.dynamic) {\n    console.warn(\n      'Payload detected a non-zero value for the `staleTimes.dynamic` option in your Next.js config. This may cause stale data to load in the Admin Panel. To clear this warning, remove the `staleTimes.dynamic` option from your Next.js config or set it to 0. In the future, Next.js may support scoping this option to specific routes.',\n    )\n  }\n\n  /**\n   * @type {import('next').NextConfig}\n   */\n  const toReturn = {\n    ...nextConfig,\n    env: {\n      ...(nextConfig?.env || {}),\n    },\n    experimental: {\n      ...(nextConfig?.experimental || {}),\n      outputFileTracingExcludes: {\n        '**/*': [\n          ...(nextConfig.experimental?.outputFileTracingExcludes?.['**/*'] || []),\n          'drizzle-kit',\n          'drizzle-kit/payload',\n          'libsql',\n        ],\n      },\n      turbo: {\n        ...(nextConfig?.experimental?.turbo || {}),\n        resolveAlias: {\n          ...(nextConfig?.experimental?.turbo?.resolveAlias || {}),\n          'payload-mock-package': 'payload-mock-package',\n        },\n      },\n    },\n    headers: async () => {\n      const headersFromConfig = 'headers' in nextConfig ? await nextConfig.headers() : []\n\n      return [\n        ...(headersFromConfig || []),\n        {\n          source: '/:path*',\n          headers: [\n            {\n              key: 'Accept-CH',\n              value: 'Sec-CH-Prefers-Color-Scheme',\n            },\n            {\n              key: 'Vary',\n              value: 'Sec-CH-Prefers-Color-Scheme',\n            },\n            {\n              key: 'Critical-CH',\n              value: 'Sec-CH-Prefers-Color-Scheme',\n            },\n          ],\n        },\n      ]\n    },\n    serverExternalPackages: [\n      ...(nextConfig?.serverExternalPackages || []),\n      'drizzle-kit',\n      'drizzle-kit/payload',\n      'libsql',\n      'pino',\n      'pino-pretty',\n      'graphql',\n    ],\n    webpack: (webpackConfig, webpackOptions) => {\n      const incomingWebpackConfig =\n        typeof nextConfig.webpack === 'function'\n          ? nextConfig.webpack(webpackConfig, webpackOptions)\n          : webpackConfig\n\n      return {\n        ...incomingWebpackConfig,\n        externals: [\n          ...(incomingWebpackConfig?.externals || []),\n          'drizzle-kit',\n          'drizzle-kit/payload',\n          'sharp',\n          'libsql',\n        ],\n        ignoreWarnings: [\n          ...(incomingWebpackConfig?.ignoreWarnings || []),\n          { module: /node_modules\\/mongodb\\/lib\\/utils\\.js/ },\n          { file: /node_modules\\/mongodb\\/lib\\/utils\\.js/ },\n          { module: /node_modules\\/mongodb\\/lib\\/bson\\.js/ },\n          { file: /node_modules\\/mongodb\\/lib\\/bson\\.js/ },\n        ],\n        resolve: {\n          ...(incomingWebpackConfig?.resolve || {}),\n          alias: {\n            ...(incomingWebpackConfig?.resolve?.alias || {}),\n          },\n          fallback: {\n            ...(incomingWebpackConfig?.resolve?.fallback || {}),\n            '@aws-sdk/credential-providers': false,\n            '@mongodb-js/zstd': false,\n            aws4: false,\n            kerberos: false,\n            'mongodb-client-encryption': false,\n            snappy: false,\n            'supports-color': false,\n            'yocto-queue': false,\n          },\n        },\n      }\n    },\n  }\n\n  if (nextConfig.basePath) {\n    toReturn.env.NEXT_BASE_PATH = nextConfig.basePath\n  }\n\n  return toReturn\n}\n\nexport default withPayload\n"],"names":["withPayload","nextConfig","experimental","staleTimes","dynamic","console","warn","toReturn","env","outputFileTracingExcludes","turbo","resolveAlias","headers","headersFromConfig","source","key","value","serverExternalPackages","webpack","webpackConfig","webpackOptions","incomingWebpackConfig","externals","ignoreWarnings","module","file","resolve","alias","fallback","aws4","kerberos","snappy","basePath","NEXT_BASE_PATH"],"mappings":"AAAA;;;;GAIG,GACH,OAAO,MAAMA,cAAc,CAACC,aAAa,CAAC,CAAC;IACzC,IAAIA,WAAWC,YAAY,EAAEC,YAAYC,SAAS;QAChDC,QAAQC,IAAI,CACV;IAEJ;IAEA;;GAEC,GACD,MAAMC,WAAW;QACf,GAAGN,UAAU;QACbO,KAAK;YACH,GAAIP,YAAYO,OAAO,CAAC,CAAC;QAC3B;QACAN,cAAc;YACZ,GAAID,YAAYC,gBAAgB,CAAC,CAAC;YAClCO,2BAA2B;gBACzB,QAAQ;uBACFR,WAAWC,YAAY,EAAEO,2BAA2B,CAAC,OAAO,IAAI,EAAE;oBACtE;oBACA;oBACA;iBACD;YACH;YACAC,OAAO;gBACL,GAAIT,YAAYC,cAAcQ,SAAS,CAAC,CAAC;gBACzCC,cAAc;oBACZ,GAAIV,YAAYC,cAAcQ,OAAOC,gBAAgB,CAAC,CAAC;oBACvD,wBAAwB;gBAC1B;YACF;QACF;QACAC,SAAS;YACP,MAAMC,oBAAoB,aAAaZ,aAAa,MAAMA,WAAWW,OAAO,KAAK,EAAE;YAEnF,OAAO;mBACDC,qBAAqB,EAAE;gBAC3B;oBACEC,QAAQ;oBACRF,SAAS;wBACP;4BACEG,KAAK;4BACLC,OAAO;wBACT;wBACA;4BACED,KAAK;4BACLC,OAAO;wBACT;wBACA;4BACED,KAAK;4BACLC,OAAO;wBACT;qBACD;gBACH;aACD;QACH;QACAC,wBAAwB;eAClBhB,YAAYgB,0BAA0B,EAAE;YAC5C;YACA;YACA;YACA;YACA;YACA;SACD;QACDC,SAAS,CAACC,eAAeC;YACvB,MAAMC,wBACJ,OAAOpB,WAAWiB,OAAO,KAAK,aAC1BjB,WAAWiB,OAAO,CAACC,eAAeC,kBAClCD;YAEN,OAAO;gBACL,GAAGE,qBAAqB;gBACxBC,WAAW;uBACLD,uBAAuBC,aAAa,EAAE;oBAC1C;oBACA;oBACA;oBACA;iBACD;gBACDC,gBAAgB;uBACVF,uBAAuBE,kBAAkB,EAAE;oBAC/C;wBAAEC,QAAQ;oBAAwC;oBAClD;wBAAEC,MAAM;oBAAwC;oBAChD;wBAAED,QAAQ;oBAAuC;oBACjD;wBAAEC,MAAM;oBAAuC;iBAChD;gBACDC,SAAS;oBACP,GAAIL,uBAAuBK,WAAW,CAAC,CAAC;oBACxCC,OAAO;wBACL,GAAIN,uBAAuBK,SAASC,SAAS,CAAC,CAAC;oBACjD;oBACAC,UAAU;wBACR,GAAIP,uBAAuBK,SAASE,YAAY,CAAC,CAAC;wBAClD,iCAAiC;wBACjC,oBAAoB;wBACpBC,MAAM;wBACNC,UAAU;wBACV,6BAA6B;wBAC7BC,QAAQ;wBACR,kBAAkB;wBAClB,eAAe;oBACjB;gBACF;YACF;QACF;IACF;IAEA,IAAI9B,WAAW+B,QAAQ,EAAE;QACvBzB,SAASC,GAAG,CAACyB,cAAc,GAAGhC,WAAW+B,QAAQ;IACnD;IAEA,OAAOzB;AACT,EAAC;AAED,eAAeP,YAAW"}