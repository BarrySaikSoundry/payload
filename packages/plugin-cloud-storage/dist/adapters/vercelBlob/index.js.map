{"version":3,"sources":["../../../src/adapters/vercelBlob/index.ts"],"sourcesContent":["import type { Adapter, GeneratedAdapter } from '@payloadcms/plugin-cloud-storage/types'\n\nimport { getGenerateUrl } from './generateURL.js'\nimport { getHandleDelete } from './handleDelete.js'\nimport { getHandleUpload } from './handleUpload.js'\nimport { getStaticHandler } from './staticHandler.js'\n\nexport interface VercelBlobAdapterArgs {\n  options?: VercelBlobAdapterUploadOptions\n\n  /**\n   * Vercel Blob storage read/write token\n   *\n   * Usually process.env.BLOB_READ_WRITE_TOKEN set by Vercel\n   */\n  token: string\n}\n\nexport interface VercelBlobAdapterUploadOptions {\n  /**\n   * Access control level\n   *\n   * @default 'public'\n   */\n  access?: 'public'\n  /**\n   * Add a random suffix to the uploaded file name\n   *\n   * @default false\n   */\n  addRandomSuffix?: boolean\n  /**\n   * Cache-Control max-age in seconds\n   *\n   * @default 31536000 (1 year)\n   */\n  cacheControlMaxAge?: number\n}\n\nconst defaultUploadOptions: VercelBlobAdapterUploadOptions = {\n  access: 'public',\n  addRandomSuffix: false,\n  cacheControlMaxAge: 60 * 60 * 24 * 365, // 1 year\n}\n\n/**\n * @deprecated Use [`@payloadcms/storage-vercel-blob`](https://www.npmjs.com/package/@payloadcms/storage-vercel-blob) instead.\n *\n * This adapter has been superceded by `@payloadcms/storage-vercel-blob` and will be removed in Payload 3.0.\n */\nexport const vercelBlobAdapter =\n  ({ options = {}, token }: VercelBlobAdapterArgs): Adapter =>\n  ({ collection, prefix }): GeneratedAdapter => {\n    if (!token) {\n      throw new Error('The token argument is required for the Vercel Blob adapter.')\n    }\n\n    // Parse storeId from token\n    const storeId = token.match(/^vercel_blob_rw_([a-z\\d]+)_[a-z\\d]+$/i)?.[1].toLowerCase()\n\n    if (!storeId) {\n      throw new Error(\n        'Invalid token format for Vercel Blob adapter. Should be vercel_blob_rw_<store_id>_<random_string>.',\n      )\n    }\n\n    const { access, addRandomSuffix, cacheControlMaxAge } = {\n      ...defaultUploadOptions,\n      ...options,\n    }\n\n    const baseUrl = `https://${storeId}.${access}.blob.vercel-storage.com`\n\n    return {\n      name: 'vercel-blob',\n      generateURL: getGenerateUrl({ baseUrl, prefix }),\n      handleDelete: getHandleDelete({ baseUrl, prefix, token }),\n      handleUpload: getHandleUpload({\n        access,\n        addRandomSuffix,\n        baseUrl,\n        cacheControlMaxAge,\n        prefix,\n        token,\n      }),\n      staticHandler: getStaticHandler({ baseUrl, token }, collection),\n    }\n  }\n"],"names":["getGenerateUrl","getHandleDelete","getHandleUpload","getStaticHandler","defaultUploadOptions","access","addRandomSuffix","cacheControlMaxAge","vercelBlobAdapter","options","token","collection","prefix","Error","storeId","match","toLowerCase","baseUrl","name","generateURL","handleDelete","handleUpload","staticHandler"],"mappings":"AAEA,SAASA,cAAc,QAAQ,mBAAkB;AACjD,SAASC,eAAe,QAAQ,oBAAmB;AACnD,SAASC,eAAe,QAAQ,oBAAmB;AACnD,SAASC,gBAAgB,QAAQ,qBAAoB;AAkCrD,MAAMC,uBAAuD;IAC3DC,QAAQ;IACRC,iBAAiB;IACjBC,oBAAoB,KAAK,KAAK,KAAK;AACrC;AAEA;;;;CAIC,GACD,OAAO,MAAMC,oBACX,CAAC,EAAEC,UAAU,CAAC,CAAC,EAAEC,KAAK,EAAyB,GAC/C,CAAC,EAAEC,UAAU,EAAEC,MAAM,EAAE;QACrB,IAAI,CAACF,OAAO;YACV,MAAM,IAAIG,MAAM;QAClB;QAEA,2BAA2B;QAC3B,MAAMC,UAAUJ,MAAMK,KAAK,CAAC,0CAA0C,CAAC,EAAE,CAACC;QAE1E,IAAI,CAACF,SAAS;YACZ,MAAM,IAAID,MACR;QAEJ;QAEA,MAAM,EAAER,MAAM,EAAEC,eAAe,EAAEC,kBAAkB,EAAE,GAAG;YACtD,GAAGH,oBAAoB;YACvB,GAAGK,OAAO;QACZ;QAEA,MAAMQ,UAAU,CAAC,QAAQ,EAAEH,QAAQ,CAAC,EAAET,OAAO,wBAAwB,CAAC;QAEtE,OAAO;YACLa,MAAM;YACNC,aAAanB,eAAe;gBAAEiB;gBAASL;YAAO;YAC9CQ,cAAcnB,gBAAgB;gBAAEgB;gBAASL;gBAAQF;YAAM;YACvDW,cAAcnB,gBAAgB;gBAC5BG;gBACAC;gBACAW;gBACAV;gBACAK;gBACAF;YACF;YACAY,eAAenB,iBAAiB;gBAAEc;gBAASP;YAAM,GAAGC;QACtD;IACF,EAAC"}