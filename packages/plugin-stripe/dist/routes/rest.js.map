{"version":3,"sources":["../../src/routes/rest.ts"],"sourcesContent":["import type { PayloadRequest } from 'payload'\n\nimport { addDataAndFileToRequest } from '@payloadcms/next/utilities'\nimport { Forbidden } from 'payload'\n\nimport type { StripePluginConfig } from '../types.js'\n\nimport { stripeProxy } from '../utilities/stripeProxy.js'\n\nexport const stripeREST = async (args: {\n  pluginConfig: StripePluginConfig\n  req: PayloadRequest\n}): Promise<any> => {\n  let responseStatus = 200\n  let responseJSON\n\n  const { pluginConfig, req } = args\n\n  await addDataAndFileToRequest(req)\n\n  const requestWithData = req\n\n  const {\n    data: {\n      stripeArgs, // example: ['cus_MGgt3Tuj3D66f2'] or [{ limit: 100 }, { stripeAccount: 'acct_1J9Z4pKZ4Z4Z4Z4Z' }]\n      stripeMethod, // example: 'subscriptions.list',\n    },\n    payload,\n    user,\n  } = requestWithData\n\n  const { stripeSecretKey } = pluginConfig\n\n  try {\n    if (!user) {\n      // TODO: make this customizable from the config\n      throw new Forbidden(req.t)\n    }\n\n    responseJSON = await stripeProxy({\n      // @ts-expect-error\n      stripeArgs,\n      // @ts-expect-error\n      stripeMethod,\n      stripeSecretKey,\n    })\n\n    const { status } = responseJSON\n    responseStatus = status\n  } catch (error: unknown) {\n    const message = `An error has occurred in the Stripe plugin REST handler: '${JSON.stringify(\n      error,\n    )}'`\n    payload.logger.error(message)\n    responseStatus = 500\n    responseJSON = {\n      message,\n    }\n  }\n\n  return Response.json(responseJSON, {\n    status: responseStatus,\n  })\n}\n"],"names":["addDataAndFileToRequest","Forbidden","stripeProxy","stripeREST","args","responseStatus","responseJSON","pluginConfig","req","requestWithData","data","stripeArgs","stripeMethod","payload","user","stripeSecretKey","t","status","error","message","JSON","stringify","logger","Response","json"],"mappings":"AAEA,SAASA,uBAAuB,QAAQ,6BAA4B;AACpE,SAASC,SAAS,QAAQ,UAAS;AAInC,SAASC,WAAW,QAAQ,8BAA6B;AAEzD,OAAO,MAAMC,aAAa,OAAOC;IAI/B,IAAIC,iBAAiB;IACrB,IAAIC;IAEJ,MAAM,EAAEC,YAAY,EAAEC,GAAG,EAAE,GAAGJ;IAE9B,MAAMJ,wBAAwBQ;IAE9B,MAAMC,kBAAkBD;IAExB,MAAM,EACJE,MAAM,EACJC,UAAU,EACVC,YAAY,EACb,EACDC,OAAO,EACPC,IAAI,EACL,GAAGL;IAEJ,MAAM,EAAEM,eAAe,EAAE,GAAGR;IAE5B,IAAI;QACF,IAAI,CAACO,MAAM;YACT,+CAA+C;YAC/C,MAAM,IAAIb,UAAUO,IAAIQ,CAAC;QAC3B;QAEAV,eAAe,MAAMJ,YAAY;YAC/B,mBAAmB;YACnBS;YACA,mBAAmB;YACnBC;YACAG;QACF;QAEA,MAAM,EAAEE,MAAM,EAAE,GAAGX;QACnBD,iBAAiBY;IACnB,EAAE,OAAOC,OAAgB;QACvB,MAAMC,UAAU,CAAC,0DAA0D,EAAEC,KAAKC,SAAS,CACzFH,OACA,CAAC,CAAC;QACJL,QAAQS,MAAM,CAACJ,KAAK,CAACC;QACrBd,iBAAiB;QACjBC,eAAe;YACba;QACF;IACF;IAEA,OAAOI,SAASC,IAAI,CAAClB,cAAc;QACjCW,QAAQZ;IACV;AACF,EAAC"}