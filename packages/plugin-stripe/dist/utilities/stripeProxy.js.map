{"version":3,"sources":["../../src/utilities/stripeProxy.ts"],"sourcesContent":["import lodashGet from 'lodash.get'\nimport Stripe from 'stripe'\n\nimport type { StripeProxy } from '../types.js'\n\nexport const stripeProxy: StripeProxy = async ({ stripeArgs, stripeMethod, stripeSecretKey }) => {\n  const stripe = new Stripe(stripeSecretKey, {\n    apiVersion: '2022-08-01',\n    appInfo: {\n      name: 'Stripe Payload Plugin',\n      url: 'https://payloadcms.com',\n    },\n  })\n\n  if (typeof stripeMethod === 'string') {\n    const topLevelMethod = stripeMethod.split('.')[0] as keyof Stripe\n    const contextToBind = stripe[topLevelMethod]\n    // NOTE: 'lodashGet' uses dot notation to get the property of an object\n    // NOTE: Stripe API methods using reference \"this\" within their functions, so we need to bind context\n    const foundMethod = lodashGet(stripe, stripeMethod).bind(contextToBind)\n\n    if (typeof foundMethod === 'function') {\n      if (Array.isArray(stripeArgs)) {\n        try {\n          const stripeResponse = await foundMethod(...stripeArgs)\n          return {\n            data: stripeResponse,\n            status: 200,\n          }\n        } catch (error: unknown) {\n          return {\n            message: `A Stripe API error has occurred: ${error}`,\n            status: 404,\n          }\n        }\n      } else {\n        throw new Error(`Argument 'stripeArgs' must be an array.`)\n      }\n    } else {\n      throw Error(\n        `The provided Stripe method of '${stripeMethod}' is not a part of the Stripe API.`,\n      )\n    }\n  } else {\n    throw Error('You must provide a Stripe method to call.')\n  }\n}\n"],"names":["lodashGet","Stripe","stripeProxy","stripeArgs","stripeMethod","stripeSecretKey","stripe","apiVersion","appInfo","name","url","topLevelMethod","split","contextToBind","foundMethod","bind","Array","isArray","stripeResponse","data","status","error","message","Error"],"mappings":"AAAA,OAAOA,eAAe,aAAY;AAClC,OAAOC,YAAY,SAAQ;AAI3B,OAAO,MAAMC,cAA2B,OAAO,EAAEC,UAAU,EAAEC,YAAY,EAAEC,eAAe,EAAE;IAC1F,MAAMC,SAAS,IAAIL,OAAOI,iBAAiB;QACzCE,YAAY;QACZC,SAAS;YACPC,MAAM;YACNC,KAAK;QACP;IACF;IAEA,IAAI,OAAON,iBAAiB,UAAU;QACpC,MAAMO,iBAAiBP,aAAaQ,KAAK,CAAC,IAAI,CAAC,EAAE;QACjD,MAAMC,gBAAgBP,MAAM,CAACK,eAAe;QAC5C,uEAAuE;QACvE,qGAAqG;QACrG,MAAMG,cAAcd,UAAUM,QAAQF,cAAcW,IAAI,CAACF;QAEzD,IAAI,OAAOC,gBAAgB,YAAY;YACrC,IAAIE,MAAMC,OAAO,CAACd,aAAa;gBAC7B,IAAI;oBACF,MAAMe,iBAAiB,MAAMJ,eAAeX;oBAC5C,OAAO;wBACLgB,MAAMD;wBACNE,QAAQ;oBACV;gBACF,EAAE,OAAOC,OAAgB;oBACvB,OAAO;wBACLC,SAAS,CAAC,iCAAiC,EAAED,MAAM,CAAC;wBACpDD,QAAQ;oBACV;gBACF;YACF,OAAO;gBACL,MAAM,IAAIG,MAAM,CAAC,uCAAuC,CAAC;YAC3D;QACF,OAAO;YACL,MAAMA,MACJ,CAAC,+BAA+B,EAAEnB,aAAa,kCAAkC,CAAC;QAEtF;IACF,OAAO;QACL,MAAMmB,MAAM;IACd;AACF,EAAC"}