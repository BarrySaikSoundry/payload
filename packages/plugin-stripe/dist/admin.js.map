{"version":3,"sources":["../src/admin.ts"],"sourcesContent":["import type { Config } from 'payload'\n\nimport type { SanitizedStripePluginConfig, StripePluginConfig } from './types.js'\n\nimport { getFields } from './fields/getFields.js'\n\nexport const stripePlugin =\n  (incomingPluginConfig: StripePluginConfig) =>\n  (config: Config): Config => {\n    const { collections } = config\n\n    // set config defaults here\n    const pluginConfig: SanitizedStripePluginConfig = {\n      ...incomingPluginConfig,\n      // TODO: in the next major version, default this to `false`\n      rest: incomingPluginConfig?.rest ?? true,\n      sync: incomingPluginConfig?.sync || [],\n    }\n\n    // NOTE: env variables are never passed to the client, but we need to know if `stripeSecretKey` is a test key\n    // unfortunately we must set the 'isTestKey' property on the config instead of using the following code:\n    // const isTestKey = stripeConfig.stripeSecretKey?.startsWith('sk_test_');\n\n    return {\n      ...config,\n      collections: collections?.map((collection) => {\n        const syncConfig = pluginConfig.sync?.find((sync) => sync.collection === collection.slug)\n\n        if (syncConfig) {\n          const fields = getFields({\n            collection,\n            pluginConfig,\n            syncConfig,\n          })\n          return {\n            ...collection,\n            fields,\n          }\n        }\n\n        return collection\n      }),\n    }\n  }\n"],"names":["getFields","stripePlugin","incomingPluginConfig","config","collections","pluginConfig","rest","sync","map","collection","syncConfig","find","slug","fields"],"mappings":"AAIA,SAASA,SAAS,QAAQ,wBAAuB;AAEjD,OAAO,MAAMC,eACX,CAACC,uBACD,CAACC;QACC,MAAM,EAAEC,WAAW,EAAE,GAAGD;QAExB,2BAA2B;QAC3B,MAAME,eAA4C;YAChD,GAAGH,oBAAoB;YACvB,2DAA2D;YAC3DI,MAAMJ,sBAAsBI,QAAQ;YACpCC,MAAML,sBAAsBK,QAAQ,EAAE;QACxC;QAEA,6GAA6G;QAC7G,wGAAwG;QACxG,0EAA0E;QAE1E,OAAO;YACL,GAAGJ,MAAM;YACTC,aAAaA,aAAaI,IAAI,CAACC;gBAC7B,MAAMC,aAAaL,aAAaE,IAAI,EAAEI,KAAK,CAACJ,OAASA,KAAKE,UAAU,KAAKA,WAAWG,IAAI;gBAExF,IAAIF,YAAY;oBACd,MAAMG,SAASb,UAAU;wBACvBS;wBACAJ;wBACAK;oBACF;oBACA,OAAO;wBACL,GAAGD,UAAU;wBACbI;oBACF;gBACF;gBAEA,OAAOJ;YACT;QACF;IACF,EAAC"}