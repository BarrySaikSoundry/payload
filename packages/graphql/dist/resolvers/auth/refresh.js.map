{"version":3,"sources":["../../../src/resolvers/auth/refresh.ts"],"sourcesContent":["import type { Collection } from 'payload'\n\nimport { generatePayloadCookie, isolateObjectProperty, refreshOperation } from 'payload'\n\nimport type { Context } from '../types.js'\n\nfunction refreshResolver(collection: Collection): any {\n  async function resolver(_, __, context: Context) {\n    const options = {\n      collection,\n      depth: 0,\n      req: isolateObjectProperty(context.req, 'transactionID'),\n    }\n\n    const result = await refreshOperation(options)\n    const cookie = generatePayloadCookie({\n      collectionConfig: collection.config,\n      payload: context.req.payload,\n      token: result.refreshedToken,\n    })\n    context.headers['Set-Cookie'] = cookie\n\n    if (collection.config.auth.removeTokenFromResponses) {\n      delete result.refreshedToken\n    }\n\n    return result\n  }\n\n  return resolver\n}\n\nexport default refreshResolver\n"],"names":["generatePayloadCookie","isolateObjectProperty","refreshOperation","refreshResolver","collection","resolver","_","__","context","options","depth","req","result","cookie","collectionConfig","config","payload","token","refreshedToken","headers","auth","removeTokenFromResponses"],"mappings":"AAEA,SAASA,qBAAqB,EAAEC,qBAAqB,EAAEC,gBAAgB,QAAQ,UAAS;AAIxF,SAASC,gBAAgBC,UAAsB;IAC7C,eAAeC,SAASC,CAAC,EAAEC,EAAE,EAAEC,OAAgB;QAC7C,MAAMC,UAAU;YACdL;YACAM,OAAO;YACPC,KAAKV,sBAAsBO,QAAQG,GAAG,EAAE;QAC1C;QAEA,MAAMC,SAAS,MAAMV,iBAAiBO;QACtC,MAAMI,SAASb,sBAAsB;YACnCc,kBAAkBV,WAAWW,MAAM;YACnCC,SAASR,QAAQG,GAAG,CAACK,OAAO;YAC5BC,OAAOL,OAAOM,cAAc;QAC9B;QACAV,QAAQW,OAAO,CAAC,aAAa,GAAGN;QAEhC,IAAIT,WAAWW,MAAM,CAACK,IAAI,CAACC,wBAAwB,EAAE;YACnD,OAAOT,OAAOM,cAAc;QAC9B;QAEA,OAAON;IACT;IAEA,OAAOP;AACT;AAEA,eAAeF,gBAAe"}