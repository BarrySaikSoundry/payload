function Me({editorConfig:r}){return r.features.nodes.map(e=>"node"in e?e.node:e)}import{useLexicalComposerContext as se}from"@lexical/react/LexicalComposerContext.js";import{mergeRegister as ce}from"@lexical/utils";import{$getSelection as O,$isRangeSelection as C,$isTextNode as ae,COMMAND_PRIORITY_LOW as ue,createCommand as me}from"lexical";import{useCallback as B,useEffect as Y,useState as de}from"react";import*as _ from"react";import{useLexicalComposerContext as A}from"@lexical/react/LexicalComposerContext.js";import{mergeRegister as L}from"@lexical/utils";import{$getSelection as k,$isRangeSelection as V,COMMAND_PRIORITY_LOW as R,KEY_ARROW_DOWN_COMMAND as U,KEY_ARROW_UP_COMMAND as j,KEY_ENTER_COMMAND as z,KEY_ESCAPE_COMMAND as G,KEY_TAB_COMMAND as q,createCommand as Q}from"lexical";import{useCallback as E,useEffect as T,useLayoutEffect as J,useMemo as Z,useRef as ee,useState as te}from"react";var ne="slash-menu-popup",v=r=>{let e=document.getElementById("slash-menu");if(!e)return;let t=e.getBoundingClientRect();t.top+t.height>window.innerHeight&&e.scrollIntoView({block:"center"}),t.top<0&&e.scrollIntoView({block:"center"}),r.scrollIntoView({block:"nearest"})};function oe(r,e,t){let n=t;for(let o=n;o<=e.length;o++)r.substring(r.length-o)===e.substring(0,o)&&(n=o);return n}function ie(r){let e=k();if(!V(e)||!e.isCollapsed())return null;let t=e.anchor;if(t.type!=="text")return null;let n=t.getNode();if(!n.isSimpleText())return null;let o=t.offset,l=n.getTextContent().slice(0,o),a=r.replaceableString.length,d=oe(l,r.matchingString,a),s=o-d;if(s<0)return null;let i;return s===0?[i]=n.splitText(o):[,i]=n.splitText(s,o),i}function re(r,e){let t=getComputedStyle(r),n=t.position==="absolute",o=e?/(auto|scroll|hidden)/:/(auto|scroll)/;if(t.position==="fixed")return document.body;for(let l=r;l=l.parentElement;)if(t=getComputedStyle(l),!(n&&t.position==="static")&&o.test(t.overflow+t.overflowY+t.overflowX))return l;return document.body}function P(r,e){let t=r.getBoundingClientRect(),n=e.getBoundingClientRect();return t.top>n.top&&t.top<n.bottom}function le(r,e,t,n){let[o]=A();T(()=>{if(e!=null&&r!=null){let l=o.getRootElement(),a=l!=null?re(l,!1):document.body,d=!1,s=P(e,a),i=function(){d||(window.requestAnimationFrame(function(){t(),d=!1}),d=!0);let f=P(e,a);f!==s&&(s=f,n?.(f))},m=new ResizeObserver(t);return window.addEventListener("resize",t),document.addEventListener("scroll",i,{capture:!0,passive:!0}),m.observe(e),()=>{m.unobserve(e),window.removeEventListener("resize",t),document.removeEventListener("scroll",i,!0)}}},[e,o,n,t,r])}var N=Q("SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND");function D({anchorElementRef:r,close:e,editor:t,groups:n,menuRenderFn:o,onSelectItem:l,resolution:a,shouldSplitNodeWithQuery:d=!1}){let[s,i]=te(null),m=a.match&&a.match.matchingString||"",f=E(c=>{let u=t.getRootElement();u!==null&&(u.setAttribute("aria-activedescendant",`${ne}__item-${c.key}`),i(c.key))},[t]),y=E(()=>{if(n!==null&&m!=null){let c=n.flatMap(u=>u.items);if(c.length){let u=c[0];f(u)}}},[n,f,m]);T(()=>{y()},[m,y]);let S=E(c=>{t.update(()=>{let u=a.match!=null&&d?ie(a.match):null;l(c,u,e,a.match?a.match.matchingString:"")})},[t,d,a.match,l,e]);T(()=>()=>{let c=t.getRootElement();c!==null&&c.removeAttribute("aria-activedescendant")},[t]),J(()=>{n===null?i(null):s===null&&y()},[n,s,f,y]),T(()=>L(t.registerCommand(N,({item:c})=>c.ref&&c.ref.current!=null?(v(c.ref.current),!0):!1,R)),[t,f]),T(()=>L(t.registerCommand(U,c=>{let u=c;if(n!==null&&n.length&&s!==null){let g=n.flatMap(p=>p.items),h=g.findIndex(p=>p.key===s),b=h!==g.length-1?h+1:0,M=g[b];f(M),M.ref!=null&&M.ref.current&&t.dispatchCommand(N,{index:b,item:M}),u.preventDefault(),u.stopImmediatePropagation()}return!0},R),t.registerCommand(j,c=>{let u=c;if(n!==null&&n.length&&s!==null){let g=n.flatMap(p=>p.items),h=g.findIndex(p=>p.key===s),b=h!==0?h-1:g.length-1,M=g[b];f(M),M.ref!=null&&M.ref.current&&v(M.ref.current),u.preventDefault(),u.stopImmediatePropagation()}return!0},R),t.registerCommand(G,c=>{let u=c;return u.preventDefault(),u.stopImmediatePropagation(),e(),!0},R),t.registerCommand(q,c=>{let u=c;if(n===null||s===null)return!1;let h=n.flatMap(b=>b.items).find(b=>b.key===s);return h?(u.preventDefault(),u.stopImmediatePropagation(),S(h),!0):!1},R),t.registerCommand(z,c=>{if(n===null||s===null)return!1;let g=n.flatMap(h=>h.items).find(h=>h.key===s);return g?(c!==null&&(c.preventDefault(),c.stopImmediatePropagation()),S(g),!0):!1},R)),[S,e,t,n,s,f]);let x=Z(()=>({groups:n,selectItemAndCleanUp:S,selectedItemKey:s,setSelectedItemKey:i}),[S,s,n]);return o(r,x,a.match?a.match.matchingString:"")}function H(r,e,t,n){let[o]=A(),l=ee(document.createElement("div")),a=E(()=>{let s=o.getRootElement(),i=l.current,m=32,f=i.firstChild;if(s!==null&&e!==null){let{height:y,width:S}=e.getRect(),{left:x,top:c}=e.getRect(),u=c;if(c-=r.getBoundingClientRect().top+window.scrollY,x-=r.getBoundingClientRect().left+window.scrollX,i.style.left=`${x+window.scrollX}px`,i.style.height=`${y}px`,i.style.width=`${S}px`,f!==null){let g=f.getBoundingClientRect(),h=g.height,b=g.width,M=s.getBoundingClientRect();x+b>M.right&&(i.style.left=`${M.right-b+window.scrollX}px`);let p=u+h+m>window.innerHeight,I=u<0;p&&!I?i.style.top=`${c+m-h+window.scrollY-(y+24)}px`:i.style.top=`${c+window.scrollY+m}px`}i.isConnected||(n!=null&&(i.className=n),i.setAttribute("aria-label","Slash menu"),i.setAttribute("id","slash-menu"),i.setAttribute("role","listbox"),i.style.display="block",i.style.position="absolute",r.append(i)),l.current=i,s.setAttribute("aria-controls","slash-menu")}},[o,e,n,r]);T(()=>{let s=o.getRootElement();if(e!==null)return a(),()=>{s!==null&&s.removeAttribute("aria-controls");let i=l.current;i!==null&&i.isConnected&&i.remove()}},[o,a,e]);let d=E(s=>{e!==null&&(s||t(null))},[e,t]);return le(e,l.current,a,d),l}import{jsx as pe}from"react/jsx-runtime";var Le=`\\.,\\+\\*\\?\\$\\@\\|#{}\\(\\)\\^\\-\\[\\]\\\\/!%'"~=<>_:;`;function fe(r){let e=r.anchor;if(e.type!=="text")return null;let t=e.getNode();if(!t.isSimpleText())return null;let n=e.offset;return t.getTextContent().slice(0,n)}function F(r,e,t){let n=t.getSelection();if(n===null||!n.isCollapsed)return!1;let o=n.anchorNode,l=r,a=n.anchorOffset;if(o==null||a==null)return!1;try{e.setStart(o,l),e.setEnd(o,a>1?a:1)}catch{return!1}return!0}function he(r){let e=null;return r.getEditorState().read(()=>{let t=O();C(t)&&(e=fe(t))}),e}function K(r,e){return e!==0?!1:r.getEditorState().read(()=>{let t=O();if(C(t)){let l=t.anchor.getNode().getPreviousSibling();return ae(l)&&l.isTextEntity()}return!1})}function W(r){_.startTransition?_.startTransition(r):r()}var ge=me("ENABLE_SLASH_MENU_COMMAND");function ve({anchorClassName:r,anchorElem:e,groups:t,menuRenderFn:n,onClose:o,onOpen:l,onQueryChange:a,onSelectItem:d,triggerFn:s}){let[i]=se(),[m,f]=de(null),y=H(e,m,f,r),S=B(()=>{f(null),o!=null&&m!==null&&o()},[o,m]),x=B(c=>{f(c),l!=null&&m===null&&l(c)},[l,m]);return Y(()=>ce(i.registerCommand(ge,({node:c})=>(i.getEditorState().read(()=>{let u={leadOffset:0,matchingString:"",replaceableString:""};if(u!==null&&!K(i,u.leadOffset)&&c!==null){let g=i._window??window,h=g.document.createRange();F(u.leadOffset,h,g)!==null&&W(()=>x({getRect:()=>h.getBoundingClientRect(),match:u}));return}}),!0),ue)),[i,x]),Y(()=>{let c=()=>{i.getEditorState().read(()=>{let g=i._window??window,h=g.document.createRange(),b=O(),M=he(i);if(!C(b)||!b.isCollapsed()||M===null||h===null){S();return}let p=s({editor:i,query:M});if(a(p?p.matchingString:null),p!==null&&!K(i,p.leadOffset)&&F(p.leadOffset,h,g)!==null){W(()=>x({getRect:()=>h.getBoundingClientRect(),match:p}));return}S()})},u=i.registerUpdateListener(c);return()=>{u()}},[i,s,a,m,S,x]),m===null||i===null?null:pe(D,{anchorElementRef:y,close:S,editor:i,groups:t,menuRenderFn:n,onSelectItem:d,resolution:m,shouldSplitNodeWithQuery:!0})}function Ae(r){return r instanceof HTMLElement}var w=class{_x;_y;constructor(e,t){this._x=e,this._y=t}calcDeltaXTo({x:e}){return this.x-e}calcDeltaYTo({y:e}){return this.y-e}calcDistanceTo(e){return Math.sqrt(Math.pow(this.calcDeltaXTo(e),2)+Math.pow(this.calcDeltaYTo(e),2))}calcHorizontalDistanceTo(e){return Math.abs(this.calcDeltaXTo(e))}calcVerticalDistance(e){return Math.abs(this.calcDeltaYTo(e))}equals({x:e,y:t}){return this.x===e&&this.y===t}get x(){return this._x}get y(){return this._y}};function X(r){return r instanceof w}var $=class r{_bottom;_left;_right;_top;constructor(e,t,n,o){let[l,a]=t<=o?[t,o]:[o,t],[d,s]=e<=n?[e,n]:[n,e];this._top=l,this._right=s,this._left=d,this._bottom=a}static fromDOM(e){let{height:t,left:n,top:o,width:l}=e.getBoundingClientRect();return r.fromLWTH(n,l,o,t)}static fromDOMRect(e){let{height:t,left:n,top:o,width:l}=e;return r.fromLWTH(n,l,o,t)}static fromLTRB(e,t,n,o){return new r(e,t,n,o)}static fromLWTH(e,t,n,o){return new r(e,n,e+t,n+o)}static fromPoints(e,t){let{x:n,y:o}=e,{x:l,y:a}=t;return r.fromLTRB(n,o,l,a)}contains(e){if(X(e)){let{x:a,y:d}=e,s=d<this._top,i=d>this._bottom,m=a<this._left,f=a>this._right;return{reason:{isOnBottomSide:i,isOnLeftSide:m,isOnRightSide:f,isOnTopSide:s},result:!s&&!i&&!m&&!f}}let{bottom:t,left:n,right:o,top:l}=e;return l>=this._top&&l<=this._bottom&&t>=this._top&&t<=this._bottom&&n>=this._left&&n<=this._right&&o>=this._left&&o<=this._right}distanceFromPoint(e){let t=this.contains(e);if(t.result)return{distance:0,isOnBottomSide:t.reason.isOnBottomSide,isOnLeftSide:t.reason.isOnLeftSide,isOnRightSide:t.reason.isOnRightSide,isOnTopSide:t.reason.isOnTopSide};let n=0,o=0;return e.x<this._left?n=this._left-e.x:e.x>this._right&&(n=e.x-this._right),e.y<this._top?o=this._top-e.y:e.y>this._bottom&&(o=e.y-this._bottom),{distance:Math.sqrt(n*n+o*o),isOnBottomSide:e.y>this._bottom,isOnLeftSide:e.x<this._left,isOnRightSide:e.x>this._right,isOnTopSide:e.y<this._top}}equals({bottom:e,left:t,right:n,top:o}){return o===this._top&&e===this._bottom&&t===this._left&&n===this._right}generateNewRect({bottom:e=this.bottom,left:t=this.left,right:n=this.right,top:o=this.top}){return new r(t,o,n,e)}intersectsWith(e){let{height:t,left:n,top:o,width:l}=e,{height:a,left:d,top:s,width:i}=this,m=n+l>=d+i?n+l:d+i,f=o+t>=s+a?o+t:s+a,y=n<=d?n:d,S=o<=s?o:s;return m-y<=l+i&&f-S<=t+a}get bottom(){return this._bottom}get height(){return Math.abs(this._bottom-this._top)}get left(){return this._left}get right(){return this._right}get top(){return this._top}get width(){return Math.abs(this._left-this._right)}};export{Me as a,Le as b,ge as c,ve as d,Ae as e,w as f,X as g,$ as h};
//# sourceMappingURL=chunk-SVDDFJRT.js.map
