"use client";import{a as $,d as S}from"./chunk-LGMNC5KQ.js";import{b as y}from"./chunk-QZIAQPM7.js";import{useLexicalComposerContext as W}from"@lexical/react/LexicalComposerContext.js";import{useLexicalNodeSelection as Y}from"@lexical/react/useLexicalNodeSelection.js";import{mergeRegister as j}from"@lexical/utils";import{getTranslation as U}from"@payloadcms/translations";import{Button as T,useConfig as q,useDocumentDrawer as z,usePayloadAPI as G,useTranslation as J}from"@payloadcms/ui";import{$getNodeByKey as M,$getSelection as Q,$isNodeSelection as V,CLICK_COMMAND as X,COMMAND_PRIORITY_LOW as C,KEY_BACKSPACE_COMMAND as Z,KEY_DELETE_COMMAND as ee}from"lexical";import te,{useCallback as R,useEffect as oe,useReducer as ae,useRef as se,useState as ne}from"react";import{jsx as n,jsxs as g}from"react/jsx-runtime";var t="lexical-relationship",A={depth:0},le=d=>{let{children:w,data:{relationTo:K,value:l},nodeKey:a}=d,m=se(null),[o]=W(),[s,i,p]=Y(a),{field:v}=y(),{collections:O,routes:{api:P},serverURL:B}=q(),[r,ie]=ne(()=>O.find(e=>e.slug===K)),{i18n:I,t:u}=J(),[_,L]=ae(e=>e+1,0),[{data:N},{setParams:D}]=G(`${B}${P}/${r.slug}/${l}`,{initialParams:A}),[x,k,{closeDrawer:E}]=z({id:l,collectionSlug:r.slug}),F=R(()=>{o.update(()=>{M(a).remove()})},[o,a]),H=te.useCallback(({doc:e})=>{D({...A,cacheBust:_}),E(),L()},[_,D,E]),f=R(e=>{if(s&&V(Q())){e.preventDefault();let b=M(a);if(S(b))return b.remove(),!0}return!1},[s,a]),h=R(e=>{let c=e;return c.target===m.current||m.current?.contains(c.target)?(c.shiftKey?i(!s):s||(p(),i(!0)),!0):!1},[s,i,p]);return oe(()=>j(o.registerCommand(X,h,C),o.registerCommand(ee,f,C),o.registerCommand(Z,f,C)),[p,o,s,a,f,i,h]),g("div",{className:[t,s&&`${t}--selected`].filter(Boolean).join(" "),contentEditable:!1,ref:m,children:[g("div",{className:`${t}__wrap`,children:[n("p",{className:`${t}__label`,children:u("fields:labelRelationship",{label:U(r.labels.singular,I)})}),n(k,{className:`${t}__doc-drawer-toggler`,children:n("p",{className:`${t}__title`,children:N?N[r?.admin?.useAsTitle||"id"]:l})})]}),o.isEditable()&&g("div",{className:`${t}__actions`,children:[n(T,{buttonStyle:"icon-label",className:`${t}__swapButton`,disabled:v?.readOnly,el:"div",icon:"swap",onClick:()=>{o.dispatchCommand($,{replace:{nodeKey:a}})},round:!0,tooltip:u("fields:swapRelationship")}),n(T,{buttonStyle:"icon-label",className:`${t}__removeButton`,disabled:v?.readOnly,icon:"x",onClick:e=>{e.preventDefault(),F()},round:!0,tooltip:u("fields:removeRelationship")})]}),l&&n(x,{onSave:H}),w]})},ve=d=>n(le,{...d});export{ve as RelationshipComponent};
//# sourceMappingURL=RelationshipComponent-EJB6LBDR.js.map
