{"version":3,"sources":["../../src/validate/validateNodes.ts"],"sourcesContent":["import type { SerializedEditorState, SerializedLexicalNode } from 'lexical'\nimport type { RichTextField, ValidateOptions } from 'payload'\n\nimport type { NodeValidation } from '../features/typesServer.js'\n\nexport async function validateNodes({\n  nodeValidations,\n  nodes,\n  validation: validationFromProps,\n}: {\n  nodeValidations: Map<string, Array<NodeValidation>>\n  nodes: SerializedLexicalNode[]\n  validation: {\n    options: ValidateOptions<unknown, unknown, RichTextField>\n    value: SerializedEditorState\n  }\n}): Promise<string | true> {\n  for (const node of nodes) {\n    // Validate node\n    if (\n      nodeValidations &&\n      typeof nodeValidations?.has === 'function' &&\n      nodeValidations?.has(node.type)\n    ) {\n      const validations = nodeValidations.get(node.type)\n      for (const validation of validations) {\n        const validationResult = await validation({\n          node,\n          nodeValidations,\n          validation: validationFromProps,\n        })\n        if (validationResult !== true) {\n          return `${node.type} node failed to validate: ${validationResult}`\n        }\n      }\n    }\n\n    // Validate node's children\n    if ('children' in node && node?.children) {\n      const childrenValidationResult = await validateNodes({\n        nodeValidations,\n        nodes: node.children as SerializedLexicalNode[],\n        validation: validationFromProps,\n      })\n      if (childrenValidationResult !== true) {\n        return childrenValidationResult\n      }\n    }\n  }\n\n  return true\n}\n"],"names":["validateNodes","nodeValidations","nodes","validation","validationFromProps","node","has","type","validations","get","validationResult","children","childrenValidationResult"],"mappings":"AAKA,OAAO,eAAeA,cAAc,EAClCC,eAAe,EACfC,KAAK,EACLC,YAAYC,mBAAmB,EAQhC;IACC,KAAK,MAAMC,QAAQH,MAAO;QACxB,gBAAgB;QAChB,IACED,mBACA,OAAOA,iBAAiBK,QAAQ,cAChCL,iBAAiBK,IAAID,KAAKE,IAAI,GAC9B;YACA,MAAMC,cAAcP,gBAAgBQ,GAAG,CAACJ,KAAKE,IAAI;YACjD,KAAK,MAAMJ,cAAcK,YAAa;gBACpC,MAAME,mBAAmB,MAAMP,WAAW;oBACxCE;oBACAJ;oBACAE,YAAYC;gBACd;gBACA,IAAIM,qBAAqB,MAAM;oBAC7B,OAAO,CAAC,EAAEL,KAAKE,IAAI,CAAC,0BAA0B,EAAEG,iBAAiB,CAAC;gBACpE;YACF;QACF;QAEA,2BAA2B;QAC3B,IAAI,cAAcL,QAAQA,MAAMM,UAAU;YACxC,MAAMC,2BAA2B,MAAMZ,cAAc;gBACnDC;gBACAC,OAAOG,KAAKM,QAAQ;gBACpBR,YAAYC;YACd;YACA,IAAIQ,6BAA6B,MAAM;gBACrC,OAAOA;YACT;QACF;IACF;IAEA,OAAO;AACT"}