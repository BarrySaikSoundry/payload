{"version":3,"sources":["../../../src/features/relationship/graphQLPopulationPromise.ts"],"sourcesContent":["import type { PopulationPromise } from '../typesServer.js'\nimport type { RelationshipFeatureProps } from './feature.server.js'\nimport type { SerializedRelationshipNode } from './nodes/RelationshipNode.js'\n\nimport { populate } from '../../populateGraphQL/populate.js'\n\nexport const relationshipPopulationPromiseHOC = (\n  props: RelationshipFeatureProps,\n): PopulationPromise<SerializedRelationshipNode> => {\n  const relationshipPopulationPromise: PopulationPromise<SerializedRelationshipNode> = ({\n    currentDepth,\n    depth,\n    draft,\n    node,\n    overrideAccess,\n    populationPromises,\n    req,\n    showHiddenFields,\n  }) => {\n    if (node?.value) {\n      // @ts-expect-error\n      const id = node?.value?.id || node?.value // for backwards-compatibility\n\n      const collection = req.payload.collections[node?.relationTo]\n\n      if (collection) {\n        const populateDepth =\n          props?.maxDepth !== undefined && props?.maxDepth < depth ? props?.maxDepth : depth\n\n        populationPromises.push(\n          populate({\n            id,\n            collectionSlug: collection.config.slug,\n            currentDepth,\n            data: node,\n            depth: populateDepth,\n            draft,\n            key: 'value',\n            overrideAccess,\n            req,\n            showHiddenFields,\n          }),\n        )\n      }\n    }\n  }\n\n  return relationshipPopulationPromise\n}\n"],"names":["populate","relationshipPopulationPromiseHOC","props","relationshipPopulationPromise","currentDepth","depth","draft","node","overrideAccess","populationPromises","req","showHiddenFields","value","id","collection","payload","collections","relationTo","populateDepth","maxDepth","undefined","push","collectionSlug","config","slug","data","key"],"mappings":"AAIA,SAASA,QAAQ,QAAQ,oCAAmC;AAE5D,OAAO,MAAMC,mCAAmC,CAC9CC;IAEA,MAAMC,gCAA+E,CAAC,EACpFC,YAAY,EACZC,KAAK,EACLC,KAAK,EACLC,IAAI,EACJC,cAAc,EACdC,kBAAkB,EAClBC,GAAG,EACHC,gBAAgB,EACjB;QACC,IAAIJ,MAAMK,OAAO;YACf,mBAAmB;YACnB,MAAMC,KAAKN,MAAMK,OAAOC,MAAMN,MAAMK,MAAM,8BAA8B;;YAExE,MAAME,aAAaJ,IAAIK,OAAO,CAACC,WAAW,CAACT,MAAMU,WAAW;YAE5D,IAAIH,YAAY;gBACd,MAAMI,gBACJhB,OAAOiB,aAAaC,aAAalB,OAAOiB,WAAWd,QAAQH,OAAOiB,WAAWd;gBAE/EI,mBAAmBY,IAAI,CACrBrB,SAAS;oBACPa;oBACAS,gBAAgBR,WAAWS,MAAM,CAACC,IAAI;oBACtCpB;oBACAqB,MAAMlB;oBACNF,OAAOa;oBACPZ;oBACAoB,KAAK;oBACLlB;oBACAE;oBACAC;gBACF;YAEJ;QACF;IACF;IAEA,OAAOR;AACT,EAAC"}